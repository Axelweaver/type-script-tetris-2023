var N=Object.defineProperty;var T=(o,t,e)=>t in o?N(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var n=(o,t,e)=>(T(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const r of i)if(r.type==="childList")for(const a of r.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&s(a)}).observe(document,{childList:!0,subtree:!0});function e(i){const r={};return i.integrity&&(r.integrity=i.integrity),i.referrerPolicy&&(r.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?r.credentials="include":i.crossOrigin==="anonymous"?r.credentials="omit":r.credentials="same-origin",r}function s(i){if(i.ep)return;i.ep=!0;const r=e(i);fetch(i.href,r)}})();function w(o,t){o!=null&&o.clearRect(t.positionX,t.positionY,t.width,t.height)}function Y(o,t,e,s,i,r,a){if(o==null)return;const h=Math.round(r*.1);o.strokeStyle=t,o.beginPath(),o.lineWidth=1,o.moveTo(s+h,i+a-h),o.lineTo(s+h,i+h),o.lineTo(s+r-h,i+h),o.stroke(),o.beginPath(),o.strokeStyle=e,o.moveTo(s+h,i+a-h),o.lineTo(s-h+r,i+a-h),o.lineTo(s-h+r,i+h),o.stroke()}function M(o,t,e,s,i,r){o!=null&&(o.strokeStyle=t,o.strokeRect(e,s,i,r))}function y(o,t,e,s,i,r){o!=null&&(o.fillStyle=t,o.fillRect(e,s,i,r))}function u(o,t,e,s){o!=null&&(o.fillStyle=e,o.font=t.font,o.textAlign=t.align,o.textBaseline="middle",o.fillText(s,t.positionX,t.positionY))}function S(o,t){return Math.floor(Math.random()*(t-o+1))+o}function X(o){const t=o.length-1;return o.map((s,i)=>s.map((r,a)=>o[t-a][i]))}const B="#gameCanvas",x=10,m=20,c=2,R=-2,E=3,b=94,f="#F0FFF0",q="#800000",k=[[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]],[[1,1,1],[0,0,1],[0,0,0]],[[1,1,1],[1,0,0],[0,0,0]],[[1,1],[1,1]],[[0,1,1],[1,1,0],[0,0,0]],[[1,1,1],[0,1,0],[0,0,0]],[[1,1,0],[0,1,1],[0,0,0]]],A=[["#87CEFA","#48D1CC","#AFEEEE"],["#B22222","#8B0000","#CD5C5C"],["#228B22","#006400","#98FB98"],["#0000CD","#00008B","#4169E1"],["#98FB98","#66CDAA","#7FFF00"],["#FFD700","#DAA520","#FFFACD"],["#FF69B4","#CD5C5C","#FFB6C1"]];class v{constructor(t,e){n(this,"_matrix");n(this,"_color");n(this,"_darkColor");n(this,"_lightColor");n(this,"_rowIndex");n(this,"_columnIndex");n(this,"_width");n(this,"_height");n(this,"_moveLeft");n(this,"_moveRight");n(this,"_moveDown");n(this,"_rotate");n(this,"_gameField");n(this,"_mergeFunc");n(this,"_eventHandlerKeydown",t=>{(t.keyCode===37||t.keyCode===65)&&(this._moveLeft=!0),(t.keyCode===39||t.keyCode===68)&&(this._moveRight=!0),(t.keyCode===40||t.keyCode===83)&&(this._moveDown=!0),(t.keyCode===38||t.keyCode===119)&&(this._rotate=!0)});n(this,"_eventHandlerKeyup",t=>{(t.keyCode===37||t.keyCode===65)&&(this._moveLeft=!1),(t.keyCode===39||t.keyCode===68)&&(this._moveRight=!1),(t.keyCode===40||t.keyCode===83)&&(this._moveDown=!1),(t.keyCode===38||t.keyCode===119)&&(this._rotate=!1)});this._gameField=t,this._mergeFunc=e,this._matrix=k[S(0,k.length-1)];const s=A[S(0,A.length-1)];this._color=s[0],this._darkColor=s[1],this._lightColor=s[2],this._height=0,this._width=0,this._rowIndex=R,this._columnIndex=E,this._moveLeft=!1,this._moveRight=!1,this._moveDown=!1,this._rotate=!1,this._calcSize(),document.addEventListener("keydown",this._eventHandlerKeydown),document.addEventListener("keyup",this._eventHandlerKeyup)}_calcSize(){const t=this._matrix.map(e=>e.map((s,i)=>s===1?i+1:0)).filter(e=>e.length!==0).flatMap(e=>e);this._width=Math.max(...t),this._height=this._matrix.filter(e=>e.some(s=>s===1)).length}_checkAndNormalize(){for(;this._matrix[0].every(t=>t===0);)this._matrix=this._matrix.slice(1).concat([new Array(this._matrix.length).fill(0)]);for(;this._matrix.every(t=>t[0]===0);)this._matrix=this._matrix.map(t=>t.slice(1).concat([0]))}move(){if(this._moveLeft&&this._columnIndex>0&&(--this._columnIndex,this._gameField.isCollision(this)&&++this._columnIndex),this._moveRight&&this._columnIndex+this._width<x&&(++this._columnIndex,this._gameField.isCollision(this)&&--this._columnIndex),this._moveDown&&this._rowIndex+this._height<m&&(++this._rowIndex,this._gameField.isCollision(this)&&(--this._rowIndex,this._mergeFunc(),this._rowIndex=R,this._columnIndex=E)),this._rotate&&this._rowIndex>=0){const t=this._matrix;for(this.rotate();this._columnIndex+this._width>=x;)--this._columnIndex;(this._rowIndex+this._height>=m||this._gameField.isCollision(this))&&(this._matrix=t)}}get matrix(){return this._matrix}get color(){return this._color}get darkColor(){return this._darkColor}get lightColor(){return this._lightColor}get rowIndex(){return this._rowIndex}get columnIndex(){return this._columnIndex}get width(){return this._width}get height(){return this._height}setMatrix(t){this._matrix=t,this._checkAndNormalize(),this._calcSize()}moveUp(){--this._rowIndex}moveDown(){++this._rowIndex}moveLeft(){--this._columnIndex}moveRight(){++this._columnIndex}rotate(){this._matrix=X(this._matrix),this._checkAndNormalize(),this._calcSize()}}class z{constructor(){n(this,"_coloredMatrix");this._coloredMatrix=[];for(let t=0;t<m;++t)this._coloredMatrix.push(new Array(x).fill({color:"",darkColor:"",lightColor:"",value:0}))}merge(t){t.matrix.forEach((e,s)=>{e.forEach((i,r)=>{const a=t.rowIndex+s;if(i===1&&a>=0){const h=r+t.columnIndex;this._coloredMatrix[a][h]={color:t.color,darkColor:t.darkColor,lightColor:t.lightColor,value:1}}})})}isCollision(t){for(let e=0;e<t.matrix.length;++e)for(let s=0;s<t.matrix[e].length;++s){if(t.rowIndex<0)continue;const i=e+t.rowIndex,r=s+t.columnIndex;if(t.matrix[e][s]===1&&this._coloredMatrix[i][r].value===1)return!0}return!1}hasFullRows(){return!!this._coloredMatrix.some(t=>t.every(e=>e.value===1))}_getFullRowIndexes(){return this._coloredMatrix.map((e,s)=>e.every(i=>(i==null?void 0:i.value)===1)?s:0).filter(e=>e>0)}getFullRowsCount(){return this._getFullRowIndexes().length}removeFullRows(){const t=this._getFullRowIndexes(),e=t.length,s=Math.min(...t);this._coloredMatrix.splice(s,e);for(let i=0;i<e;++i)this._coloredMatrix.unshift(new Array(x).fill({color:"",darkColor:"",lightColor:"",value:0}))}isOver(){return this._coloredMatrix[0].some(t=>t.value===1)}get coloredMatrix(){return this._coloredMatrix}}class P{constructor(t){n(this,"canvas");n(this,"_context");n(this,"_gameField");n(this,"_nextFigureField");n(this,"_scoreField");n(this,"_textInfo");n(this,"_secondaryTextInfo");n(this,"_gameSquare");this.canvas=document.querySelector(t),this._context=this.canvas.getContext("2d");const e=Math.round(this.canvas.width/2);this._gameField={positionX:Math.round(this.canvas.width/2)-Math.round(e/2),positionY:Math.round(this.canvas.height/2)-Math.round(e/2)*2,width:e,height:e*2},this._nextFigureField={positionX:this._gameField.positionX+this._gameField.width+Math.round(e/8),positionY:this._gameField.positionY+Math.round(e/8),width:Math.round(e/4),height:Math.round(e/4)*2},this._scoreField={positionX:12,positionY:this._nextFigureField.positionY-20,width:Math.round(this.canvas.width/4)-18,height:this._gameField.height},this._textInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2),fontSize:Math.round(this.canvas.width/18),font:"",align:"center"},this._textInfo.font=`bold ${this._textInfo.fontSize}px Cascadia Mono SemiBold`,this._secondaryTextInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2)+Math.round(this.canvas.height/5),fontSize:Math.round(this.canvas.width/22),font:"",align:"center"},this._secondaryTextInfo.font=`bold ${this._secondaryTextInfo.fontSize}px Cascadia Mono SemiBold`,this._gameSquare={width:Math.round(e/x)-c,height:Math.round(this._gameField.height/m)-c}}clearGameField(){w(this._context,this._gameField)}cleartNextFigure(){w(this._context,this._nextFigureField)}clearScoreInfo(){w(this._context,this._scoreField)}drawScoreInfo(t,e,s){const i=this._secondaryTextInfo;i.positionX=12,i.positionY=this._nextFigureField.positionY-20,i.font="bold 16px Cascadia Mono SemiBold",i.align="left",u(this._context,i,f,"SCORE:"),i.font="bold 20px Cascadia Mono SemiBold",i.positionY+=40,u(this._context,i,f,`${s}`.padStart(9,"0")),i.positionY+=80,i.font="bold 16px Cascadia Mono SemiBold",u(this._context,i,f,`LEVEL: ${t}`),i.positionY+=80,u(this._context,i,f,`LINES: ${e}`)}drawNextFigureField(){const t=this._secondaryTextInfo;t.positionX=this._nextFigureField.positionX,t.positionY=this._nextFigureField.positionY-20,t.font="bold 16px Cascadia Mono SemiBold",t.align="left",u(this._context,t,f,"N E X T:");for(let e=1;e<3;++e)M(this._context,f,this._nextFigureField.positionX-e,this._nextFigureField.positionY-e,this._nextFigureField.width+e*2,this._nextFigureField.height+e*2)}drawGameField(){for(let t=1;t<4;++t)M(this._context,f,this._gameField.positionX-c-t,this._gameField.positionY-c-t,this._gameField.width+c+t*2,this._gameField.height+c+t*2)}drawNextFigure(t){const e=Math.round(this._nextFigureField.width/5)-1;t.matrix.forEach((s,i)=>{s.forEach((r,a)=>{if(r===1){const h=this._nextFigureField.positionX+(a+1)*(e+1),O=this._nextFigureField.positionY+(i+3)*(e+1);y(this._context,t.color,h,O,e,e)}})})}drawGameFigure(t){t.matrix.forEach((e,s)=>{e.forEach((i,r)=>{i===1&&this.drawGameSquare(t.columnIndex+r,t.rowIndex+s,t.color,t.darkColor,t.lightColor)})})}drawGameSquare(t,e,s,i,r){if(e<0)return;const a=this._gameField.positionX+(this._gameSquare.width+c)*t,h=this._gameField.positionY+(this._gameSquare.height+c)*e;y(this._context,s,a,h,this._gameSquare.width,this._gameSquare.height),Y(this._context,i,r,a,h,this._gameSquare.width,this._gameSquare.height)}drawFieldMatrix(t){t.coloredMatrix.forEach((e,s)=>{e.forEach((i,r)=>{(i==null?void 0:i.value)===1&&this.drawGameSquare(r,s,i==null?void 0:i.color,i==null?void 0:i.darkColor,i==null?void 0:i.lightColor)})})}drawInfo(t,e){u(this._context,this._textInfo,e,t)}drawSecondaryInfo(t,e){u(this._context,this._secondaryTextInfo,e,t)}}const l=new P(B),_=new z;let F=new v(_,g),d=new v(_,g),L=0,G=0;const I=1;let C=0,p=0;function D(){if(l.clearGameField(),++G>12&&(d.move(),G=0),++L>b&&(d.rowIndex+d.height<m&&(d.moveDown(),_.isCollision(d)&&(d.moveUp(),g())),d.rowIndex+d.height>=m&&g(),L=0),l.drawFieldMatrix(_),l.drawGameFigure(d),_.isOver()){U();return}requestAnimationFrame(()=>{D()})}function g(){_.merge(d),d=F,F=new v(_,g),l.cleartNextFigure(),l.drawNextFigure(F);const o=_.getFullRowsCount();o>0&&(C+=I*o*10,p+=o,_.removeFullRows(),l.clearScoreInfo(),l.drawScoreInfo(I,p,C))}function U(){l.drawInfo("GAME OVER",q)}l.drawGameField();l.drawNextFigureField();l.drawNextFigure(F);l.drawScoreInfo(I,p,C);D();
