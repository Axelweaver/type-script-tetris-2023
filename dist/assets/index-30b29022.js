var ce=Object.defineProperty;var he=(s,o,t)=>o in s?ce(s,o,{enumerable:!0,configurable:!0,writable:!0,value:t}):s[o]=t;var w=(s,o,t)=>(he(s,typeof o!="symbol"?o+"":o,t),t);(function(){const o=document.createElement("link").relList;if(o&&o.supports&&o.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))i(a);new MutationObserver(a=>{for(const f of a)if(f.type==="childList")for(const c of f.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&i(c)}).observe(document,{childList:!0,subtree:!0});function t(a){const f={};return a.integrity&&(f.integrity=a.integrity),a.referrerPolicy&&(f.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?f.credentials="include":a.crossOrigin==="anonymous"?f.credentials="omit":f.credentials="same-origin",f}function i(a){if(a.ep)return;a.ep=!0;const f=t(a);fetch(a.href,f)}})();function H(s,o){s!=null&&s.clearRect(o.positionX,o.positionY,o.width,o.height)}function pe(s,o,t,i,a,f,c){if(s==null)return;const v=Math.round(f*.1);s.strokeStyle=o,s.beginPath(),s.lineWidth=1,s.moveTo(i+v,a+c-v),s.lineTo(i+v,a+v),s.lineTo(i+f-v,a+v),s.stroke(),s.beginPath(),s.strokeStyle=t,s.moveTo(i+v,a+c-v),s.lineTo(i-v+f,a+c-v),s.lineTo(i-v+f,a+v),s.stroke()}function ne(s,o,t,i,a,f){s!=null&&(s.strokeStyle=o,s.strokeRect(t,i,a,f))}function j(s,o,t,i,a,f){s!=null&&(s.fillStyle=o,s.fillRect(t,i,a,f))}function me(s,o,t,i,a=1){s!=null&&(o=o/a,t=t/a,s.scale(a,a),s.beginPath(),s.lineWidth=1,s.fillStyle=i,s.strokeStyle=i,s.moveTo(o,t),s.moveTo(o+47.0849493,t-142108547e-22),s.lineTo(o+298.668,t+251.583611),s.lineTo(o+304.101001,t+257.015597),s.lineTo(o+304.101,t+257.016),s.lineTo(o+353.573532,t+306.488791),s.bezierCurveTo(o+353.573732,t+306.488458,o+353.573933,t+306.488124,o+353.574133,t+306.48779),s.lineTo(o+384.435257,t+337.348961),s.lineTo(o+384.434,t+337.349),s.lineTo(o+409.751616,t+362.666662),s.lineTo(o+379.581717,t+392.836561),s.lineTo(o+191.749,t+205.003),s.lineTo(o+191.749973,t+369.105851),s.lineTo(o+81.0208,t+283.647505),s.lineTo(o+710542736e-23,t+283.647505),s.lineTo(o+710542736e-23,t+112.980838),s.lineTo(o+80.8957867,t+112.980838),s.lineTo(o+91.433,t+104.688),s.lineTo(o+16.9150553,t+30.169894),s.lineTo(o+47.0849493,t-142108547e-22),s.closePath(),s.moveTo(o+361.298133,t+28.0146513),s.bezierCurveTo(o+429.037729,t+103.653701,o+443.797162,t+209.394226,o+405.578884,t+298.151284),s.lineTo(o+372.628394,t+265.201173),s.bezierCurveTo(o+396.498256,t+194.197542,o+381.626623,t+113.228555,o+328.013013,t+54.642278),s.lineTo(o+361.298133,t+28.0146513),s.closePath(),s.moveTo(o+276.912853,t+95.5237713),s.bezierCurveTo(o+305.539387,t+127.448193,o+318.4688,t+168.293162,o+315.701304,t+208.275874),s.lineTo(o+266.464558,t+159.040303),s.bezierCurveTo(o+261.641821,t+146.125608,o+254.316511,t+133.919279,o+244.488548,t+123.156461),s.lineTo(o+243.588693,t+122.182545),s.lineTo(o+276.912853,t+95.5237713),s.closePath(),s.moveTo(o+191.749973,t+25.7516113),s.lineTo(o+191.749,t+84.3256113),s.lineTo(o+158.969,t+51.5456113),s.lineTo(o+191.749973,t+25.7516113),s.closePath(),s.fill("evenodd"),s.stroke(),s.restore(),s.setTransform(1,0,0,1,0,0))}function ve(s,o,t,i,a=1){s!=null&&(o=o/a,t=t/a,s.scale(a,a),s.beginPath(),s.lineWidth=1,s.fillStyle=i,s.strokeStyle=i,s.moveTo(o,t),s.translate(42.666667,85.333333),s.moveTo(o+361.299413,t+341.610667),s.lineTo(o+328.014293,t+314.98176),s.bezierCurveTo(o+402.206933,t+233.906133,o+402.206933,t+109.96608,o+328.013013,t+28.8906667),s.lineTo(o+361.298133,t+2.26304),s.bezierCurveTo(o+447.910187,t+98.97536,o+447.908907,t+244.898347,o+361.299413,t+341.610667),s.closePath(),s.moveTo(o+276.912853,t+69.77216),s.lineTo(o+243.588693,t+96.4309333),s.bezierCurveTo(o+283.38432,t+138.998613,o+283.38304,t+204.87488,o+243.589973,t+247.44256),s.lineTo(o+276.914133,t+274.101333),s.bezierCurveTo(o+329.118507,t+215.880107,o+329.118507,t+127.992107,o+276.912853,t+69.77216),s.closePath(),s.moveTo(o+191.749973,t+142108547e-22),s.lineTo(o+80.8957867,t+87.2292267),s.lineTo(o+710542736e-23,t+87.2292267),s.lineTo(o+710542736e-23,t+257.895893),s.lineTo(o+81.0208,t+257.895893),s.lineTo(o+191.749973,t+343.35424),s.lineTo(o+191.749973,t+142108547e-22),s.lineTo(o+191.749973,t+142108547e-22),s.closePath(),s.fill("evenodd"),s.stroke(),s.restore(),s.setTransform(1,0,0,1,0,0))}function E(s,o,t,i){s!=null&&(s.fillStyle=t,s.font=o.font,s.textAlign=o.align,s.textBaseline="middle",s.fillText(i,o.positionX,o.positionY))}function re(s,o){return Math.floor(Math.random()*(o-s+1))+s}function ge(s){const o=s.length-1;return s.map((i,a)=>i.map((f,c)=>s[o-c][a]))}const we="#gameCanvas",k=10,G=20,M=2,oe=-2,ae=3,ye=94,F="#F0FFF0",Ae="#B22222",X="#DCDCDC",ie=[[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]],[[1,1,1],[0,0,1],[0,0,0]],[[1,1,1],[1,0,0],[0,0,0]],[[1,1],[1,1]],[[0,1,1],[1,1,0],[0,0,0]],[[1,1,1],[0,1,0],[0,0,0]],[[1,1,0],[0,1,1],[0,0,0]]],le=[["#87CEFA","#48D1CC","#AFEEEE"],["#B22222","#8B0000","#CD5C5C"],["#228B22","#006400","#98FB98"],["#0000CD","#00008B","#4169E1"],["#98FB98","#66CDAA","#7FFF00"],["#FFD700","#DAA520","#FFFACD"],["#FF69B4","#CD5C5C","#FFB6C1"]];var P=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{},C={};/*!
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(s){(function(){var o=function(){this.init()};o.prototype={init:function(){var e=this||t;return e._counter=1e3,e._html5AudioPool=[],e.html5PoolSize=10,e._codecs={},e._howls=[],e._muted=!1,e._volume=1,e._canPlayEvent="canplaythrough",e._navigator=typeof window<"u"&&window.navigator?window.navigator:null,e.masterGain=null,e.noAudio=!1,e.usingWebAudio=!0,e.autoSuspend=!0,e.ctx=null,e.autoUnlock=!0,e._setup(),e},volume:function(e){var n=this||t;if(e=parseFloat(e),n.ctx||x(),typeof e<"u"&&e>=0&&e<=1){if(n._volume=e,n._muted)return n;n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e,t.ctx.currentTime);for(var r=0;r<n._howls.length;r++)if(!n._howls[r]._webAudio)for(var l=n._howls[r]._getSoundIds(),d=0;d<l.length;d++){var _=n._howls[r]._soundById(l[d]);_&&_._node&&(_._node.volume=_._volume*e)}return n}return n._volume},mute:function(e){var n=this||t;n.ctx||x(),n._muted=e,n.usingWebAudio&&n.masterGain.gain.setValueAtTime(e?0:n._volume,t.ctx.currentTime);for(var r=0;r<n._howls.length;r++)if(!n._howls[r]._webAudio)for(var l=n._howls[r]._getSoundIds(),d=0;d<l.length;d++){var _=n._howls[r]._soundById(l[d]);_&&_._node&&(_._node.muted=e?!0:_._muted)}return n},stop:function(){for(var e=this||t,n=0;n<e._howls.length;n++)e._howls[n].stop();return e},unload:function(){for(var e=this||t,n=e._howls.length-1;n>=0;n--)e._howls[n].unload();return e.usingWebAudio&&e.ctx&&typeof e.ctx.close<"u"&&(e.ctx.close(),e.ctx=null,x()),e},codecs:function(e){return(this||t)._codecs[e.replace(/^x-/,"")]},_setup:function(){var e=this||t;if(e.state=e.ctx&&e.ctx.state||"suspended",e._autoSuspend(),!e.usingWebAudio)if(typeof Audio<"u")try{var n=new Audio;typeof n.oncanplaythrough>"u"&&(e._canPlayEvent="canplay")}catch{e.noAudio=!0}else e.noAudio=!0;try{var n=new Audio;n.muted&&(e.noAudio=!0)}catch{}return e.noAudio||e._setupCodecs(),e},_setupCodecs:function(){var e=this||t,n=null;try{n=typeof Audio<"u"?new Audio:null}catch{return e}if(!n||typeof n.canPlayType!="function")return e;var r=n.canPlayType("audio/mpeg;").replace(/^no$/,""),l=e._navigator?e._navigator.userAgent:"",d=l.match(/OPR\/([0-6].)/g),_=d&&parseInt(d[0].split("/")[1],10)<33,u=l.indexOf("Safari")!==-1&&l.indexOf("Chrome")===-1,p=l.match(/Version\/(.*?) /),g=u&&p&&parseInt(p[1],10)<15;return e._codecs={mp3:!!(!_&&(r||n.canPlayType("audio/mp3;").replace(/^no$/,""))),mpeg:!!r,opus:!!n.canPlayType('audio/ogg; codecs="opus"').replace(/^no$/,""),ogg:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),oga:!!n.canPlayType('audio/ogg; codecs="vorbis"').replace(/^no$/,""),wav:!!(n.canPlayType('audio/wav; codecs="1"')||n.canPlayType("audio/wav")).replace(/^no$/,""),aac:!!n.canPlayType("audio/aac;").replace(/^no$/,""),caf:!!n.canPlayType("audio/x-caf;").replace(/^no$/,""),m4a:!!(n.canPlayType("audio/x-m4a;")||n.canPlayType("audio/m4a;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),m4b:!!(n.canPlayType("audio/x-m4b;")||n.canPlayType("audio/m4b;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),mp4:!!(n.canPlayType("audio/x-mp4;")||n.canPlayType("audio/mp4;")||n.canPlayType("audio/aac;")).replace(/^no$/,""),weba:!!(!g&&n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),webm:!!(!g&&n.canPlayType('audio/webm; codecs="vorbis"').replace(/^no$/,"")),dolby:!!n.canPlayType('audio/mp4; codecs="ec-3"').replace(/^no$/,""),flac:!!(n.canPlayType("audio/x-flac;")||n.canPlayType("audio/flac;")).replace(/^no$/,"")},e},_unlockAudio:function(){var e=this||t;if(!(e._audioUnlocked||!e.ctx)){e._audioUnlocked=!1,e.autoUnlock=!1,!e._mobileUnloaded&&e.ctx.sampleRate!==44100&&(e._mobileUnloaded=!0,e.unload()),e._scratchBuffer=e.ctx.createBuffer(1,1,22050);var n=function(r){for(;e._html5AudioPool.length<e.html5PoolSize;)try{var l=new Audio;l._unlocked=!0,e._releaseHtml5Audio(l)}catch{e.noAudio=!0;break}for(var d=0;d<e._howls.length;d++)if(!e._howls[d]._webAudio)for(var _=e._howls[d]._getSoundIds(),u=0;u<_.length;u++){var p=e._howls[d]._soundById(_[u]);p&&p._node&&!p._node._unlocked&&(p._node._unlocked=!0,p._node.load())}e._autoResume();var g=e.ctx.createBufferSource();g.buffer=e._scratchBuffer,g.connect(e.ctx.destination),typeof g.start>"u"?g.noteOn(0):g.start(0),typeof e.ctx.resume=="function"&&e.ctx.resume(),g.onended=function(){g.disconnect(0),e._audioUnlocked=!0,document.removeEventListener("touchstart",n,!0),document.removeEventListener("touchend",n,!0),document.removeEventListener("click",n,!0),document.removeEventListener("keydown",n,!0);for(var T=0;T<e._howls.length;T++)e._howls[T]._emit("unlock")}};return document.addEventListener("touchstart",n,!0),document.addEventListener("touchend",n,!0),document.addEventListener("click",n,!0),document.addEventListener("keydown",n,!0),e}},_obtainHtml5Audio:function(){var e=this||t;if(e._html5AudioPool.length)return e._html5AudioPool.pop();var n=new Audio().play();return n&&typeof Promise<"u"&&(n instanceof Promise||typeof n.then=="function")&&n.catch(function(){console.warn("HTML5 Audio pool exhausted, returning potentially locked audio object.")}),new Audio},_releaseHtml5Audio:function(e){var n=this||t;return e._unlocked&&n._html5AudioPool.push(e),n},_autoSuspend:function(){var e=this;if(!(!e.autoSuspend||!e.ctx||typeof e.ctx.suspend>"u"||!t.usingWebAudio)){for(var n=0;n<e._howls.length;n++)if(e._howls[n]._webAudio){for(var r=0;r<e._howls[n]._sounds.length;r++)if(!e._howls[n]._sounds[r]._paused)return e}return e._suspendTimer&&clearTimeout(e._suspendTimer),e._suspendTimer=setTimeout(function(){if(e.autoSuspend){e._suspendTimer=null,e.state="suspending";var l=function(){e.state="suspended",e._resumeAfterSuspend&&(delete e._resumeAfterSuspend,e._autoResume())};e.ctx.suspend().then(l,l)}},3e4),e}},_autoResume:function(){var e=this;if(!(!e.ctx||typeof e.ctx.resume>"u"||!t.usingWebAudio))return e.state==="running"&&e.ctx.state!=="interrupted"&&e._suspendTimer?(clearTimeout(e._suspendTimer),e._suspendTimer=null):e.state==="suspended"||e.state==="running"&&e.ctx.state==="interrupted"?(e.ctx.resume().then(function(){e.state="running";for(var n=0;n<e._howls.length;n++)e._howls[n]._emit("resume")}),e._suspendTimer&&(clearTimeout(e._suspendTimer),e._suspendTimer=null)):e.state==="suspending"&&(e._resumeAfterSuspend=!0),e}};var t=new o,i=function(e){var n=this;if(!e.src||e.src.length===0){console.error("An array of source files must be passed with any new Howl.");return}n.init(e)};i.prototype={init:function(e){var n=this;return t.ctx||x(),n._autoplay=e.autoplay||!1,n._format=typeof e.format!="string"?e.format:[e.format],n._html5=e.html5||!1,n._muted=e.mute||!1,n._loop=e.loop||!1,n._pool=e.pool||5,n._preload=typeof e.preload=="boolean"||e.preload==="metadata"?e.preload:!0,n._rate=e.rate||1,n._sprite=e.sprite||{},n._src=typeof e.src!="string"?e.src:[e.src],n._volume=e.volume!==void 0?e.volume:1,n._xhr={method:e.xhr&&e.xhr.method?e.xhr.method:"GET",headers:e.xhr&&e.xhr.headers?e.xhr.headers:null,withCredentials:e.xhr&&e.xhr.withCredentials?e.xhr.withCredentials:!1},n._duration=0,n._state="unloaded",n._sounds=[],n._endTimers={},n._queue=[],n._playLock=!1,n._onend=e.onend?[{fn:e.onend}]:[],n._onfade=e.onfade?[{fn:e.onfade}]:[],n._onload=e.onload?[{fn:e.onload}]:[],n._onloaderror=e.onloaderror?[{fn:e.onloaderror}]:[],n._onplayerror=e.onplayerror?[{fn:e.onplayerror}]:[],n._onpause=e.onpause?[{fn:e.onpause}]:[],n._onplay=e.onplay?[{fn:e.onplay}]:[],n._onstop=e.onstop?[{fn:e.onstop}]:[],n._onmute=e.onmute?[{fn:e.onmute}]:[],n._onvolume=e.onvolume?[{fn:e.onvolume}]:[],n._onrate=e.onrate?[{fn:e.onrate}]:[],n._onseek=e.onseek?[{fn:e.onseek}]:[],n._onunlock=e.onunlock?[{fn:e.onunlock}]:[],n._onresume=[],n._webAudio=t.usingWebAudio&&!n._html5,typeof t.ctx<"u"&&t.ctx&&t.autoUnlock&&t._unlockAudio(),t._howls.push(n),n._autoplay&&n._queue.push({event:"play",action:function(){n.play()}}),n._preload&&n._preload!=="none"&&n.load(),n},load:function(){var e=this,n=null;if(t.noAudio){e._emit("loaderror",null,"No audio support.");return}typeof e._src=="string"&&(e._src=[e._src]);for(var r=0;r<e._src.length;r++){var l,d;if(e._format&&e._format[r])l=e._format[r];else{if(d=e._src[r],typeof d!="string"){e._emit("loaderror",null,"Non-string found in selected audio sources - ignoring.");continue}l=/^data:audio\/([^;,]+);/i.exec(d),l||(l=/\.([^.]+)$/.exec(d.split("?",1)[0])),l&&(l=l[1].toLowerCase())}if(l||console.warn('No file extension was found. Consider using the "format" property or specify an extension.'),l&&t.codecs(l)){n=e._src[r];break}}if(!n){e._emit("loaderror",null,"No codec support for selected audio sources.");return}return e._src=n,e._state="loading",window.location.protocol==="https:"&&n.slice(0,5)==="http:"&&(e._html5=!0,e._webAudio=!1),new a(e),e._webAudio&&c(e),e},play:function(e,n){var r=this,l=null;if(typeof e=="number")l=e,e=null;else{if(typeof e=="string"&&r._state==="loaded"&&!r._sprite[e])return null;if(typeof e>"u"&&(e="__default",!r._playLock)){for(var d=0,_=0;_<r._sounds.length;_++)r._sounds[_]._paused&&!r._sounds[_]._ended&&(d++,l=r._sounds[_]._id);d===1?e=null:l=null}}var u=l?r._soundById(l):r._inactiveSound();if(!u)return null;if(l&&!e&&(e=u._sprite||"__default"),r._state!=="loaded"){u._sprite=e,u._ended=!1;var p=u._id;return r._queue.push({event:"play",action:function(){r.play(p)}}),p}if(l&&!u._paused)return n||r._loadQueue("play"),u._id;r._webAudio&&t._autoResume();var g=Math.max(0,u._seek>0?u._seek:r._sprite[e][0]/1e3),T=Math.max(0,(r._sprite[e][0]+r._sprite[e][1])/1e3-g),S=T*1e3/Math.abs(u._rate),L=r._sprite[e][0]/1e3,K=(r._sprite[e][0]+r._sprite[e][1])/1e3;u._sprite=e,u._ended=!1;var J=function(){u._paused=!1,u._seek=g,u._start=L,u._stop=K,u._loop=!!(u._loop||r._sprite[e][2])};if(g>=K){r._ended(u);return}var y=u._node;if(r._webAudio){var Y=function(){r._playLock=!1,J(),r._refreshBuffer(u);var R=u._muted||r._muted?0:u._volume;y.gain.setValueAtTime(R,t.ctx.currentTime),u._playStart=t.ctx.currentTime,typeof y.bufferSource.start>"u"?u._loop?y.bufferSource.noteGrainOn(0,g,86400):y.bufferSource.noteGrainOn(0,g,T):u._loop?y.bufferSource.start(0,g,86400):y.bufferSource.start(0,g,T),S!==1/0&&(r._endTimers[u._id]=setTimeout(r._ended.bind(r,u),S)),n||setTimeout(function(){r._emit("play",u._id),r._loadQueue()},0)};t.state==="running"&&t.ctx.state!=="interrupted"?Y():(r._playLock=!0,r.once("resume",Y),r._clearTimer(u._id))}else{var ee=function(){y.currentTime=g,y.muted=u._muted||r._muted||t._muted||y.muted,y.volume=u._volume*t.volume(),y.playbackRate=u._rate;try{var R=y.play();if(R&&typeof Promise<"u"&&(R instanceof Promise||typeof R.then=="function")?(r._playLock=!0,J(),R.then(function(){r._playLock=!1,y._unlocked=!0,n?r._loadQueue():r._emit("play",u._id)}).catch(function(){r._playLock=!1,r._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction."),u._ended=!0,u._paused=!0})):n||(r._playLock=!1,J(),r._emit("play",u._id)),y.playbackRate=u._rate,y.paused){r._emit("playerror",u._id,"Playback was unable to start. This is most commonly an issue on mobile devices and Chrome where playback was not within a user interaction.");return}e!=="__default"||u._loop?r._endTimers[u._id]=setTimeout(r._ended.bind(r,u),S):(r._endTimers[u._id]=function(){r._ended(u),y.removeEventListener("ended",r._endTimers[u._id],!1)},y.addEventListener("ended",r._endTimers[u._id],!1))}catch(fe){r._emit("playerror",u._id,fe)}};y.src==="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA"&&(y.src=r._src,y.load());var _e=window&&window.ejecta||!y.readyState&&t._navigator.isCocoonJS;if(y.readyState>=3||_e)ee();else{r._playLock=!0,r._state="loading";var te=function(){r._state="loaded",ee(),y.removeEventListener(t._canPlayEvent,te,!1)};y.addEventListener(t._canPlayEvent,te,!1),r._clearTimer(u._id)}}return u._id},pause:function(e){var n=this;if(n._state!=="loaded"||n._playLock)return n._queue.push({event:"pause",action:function(){n.pause(e)}}),n;for(var r=n._getSoundIds(e),l=0;l<r.length;l++){n._clearTimer(r[l]);var d=n._soundById(r[l]);if(d&&!d._paused&&(d._seek=n.seek(r[l]),d._rateSeek=0,d._paused=!0,n._stopFade(r[l]),d._node))if(n._webAudio){if(!d._node.bufferSource)continue;typeof d._node.bufferSource.stop>"u"?d._node.bufferSource.noteOff(0):d._node.bufferSource.stop(0),n._cleanBuffer(d._node)}else(!isNaN(d._node.duration)||d._node.duration===1/0)&&d._node.pause();arguments[1]||n._emit("pause",d?d._id:null)}return n},stop:function(e,n){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"stop",action:function(){r.stop(e)}}),r;for(var l=r._getSoundIds(e),d=0;d<l.length;d++){r._clearTimer(l[d]);var _=r._soundById(l[d]);_&&(_._seek=_._start||0,_._rateSeek=0,_._paused=!0,_._ended=!0,r._stopFade(l[d]),_._node&&(r._webAudio?_._node.bufferSource&&(typeof _._node.bufferSource.stop>"u"?_._node.bufferSource.noteOff(0):_._node.bufferSource.stop(0),r._cleanBuffer(_._node)):(!isNaN(_._node.duration)||_._node.duration===1/0)&&(_._node.currentTime=_._start||0,_._node.pause(),_._node.duration===1/0&&r._clearSound(_._node))),n||r._emit("stop",_._id))}return r},mute:function(e,n){var r=this;if(r._state!=="loaded"||r._playLock)return r._queue.push({event:"mute",action:function(){r.mute(e,n)}}),r;if(typeof n>"u")if(typeof e=="boolean")r._muted=e;else return r._muted;for(var l=r._getSoundIds(n),d=0;d<l.length;d++){var _=r._soundById(l[d]);_&&(_._muted=e,_._interval&&r._stopFade(_._id),r._webAudio&&_._node?_._node.gain.setValueAtTime(e?0:_._volume,t.ctx.currentTime):_._node&&(_._node.muted=t._muted?!0:e),r._emit("mute",_._id))}return r},volume:function(){var e=this,n=arguments,r,l;if(n.length===0)return e._volume;if(n.length===1||n.length===2&&typeof n[1]>"u"){var d=e._getSoundIds(),_=d.indexOf(n[0]);_>=0?l=parseInt(n[0],10):r=parseFloat(n[0])}else n.length>=2&&(r=parseFloat(n[0]),l=parseInt(n[1],10));var u;if(typeof r<"u"&&r>=0&&r<=1){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"volume",action:function(){e.volume.apply(e,n)}}),e;typeof l>"u"&&(e._volume=r),l=e._getSoundIds(l);for(var p=0;p<l.length;p++)u=e._soundById(l[p]),u&&(u._volume=r,n[2]||e._stopFade(l[p]),e._webAudio&&u._node&&!u._muted?u._node.gain.setValueAtTime(r,t.ctx.currentTime):u._node&&!u._muted&&(u._node.volume=r*t.volume()),e._emit("volume",u._id))}else return u=l?e._soundById(l):e._sounds[0],u?u._volume:0;return e},fade:function(e,n,r,l){var d=this;if(d._state!=="loaded"||d._playLock)return d._queue.push({event:"fade",action:function(){d.fade(e,n,r,l)}}),d;e=Math.min(Math.max(0,parseFloat(e)),1),n=Math.min(Math.max(0,parseFloat(n)),1),r=parseFloat(r),d.volume(e,l);for(var _=d._getSoundIds(l),u=0;u<_.length;u++){var p=d._soundById(_[u]);if(p){if(l||d._stopFade(_[u]),d._webAudio&&!p._muted){var g=t.ctx.currentTime,T=g+r/1e3;p._volume=e,p._node.gain.setValueAtTime(e,g),p._node.gain.linearRampToValueAtTime(n,T)}d._startFadeInterval(p,e,n,r,_[u],typeof l>"u")}}return d},_startFadeInterval:function(e,n,r,l,d,_){var u=this,p=n,g=r-n,T=Math.abs(g/.01),S=Math.max(4,T>0?l/T:l),L=Date.now();e._fadeTo=r,e._interval=setInterval(function(){var K=(Date.now()-L)/l;L=Date.now(),p+=g*K,p=Math.round(p*100)/100,g<0?p=Math.max(r,p):p=Math.min(r,p),u._webAudio?e._volume=p:u.volume(p,e._id,!0),_&&(u._volume=p),(r<n&&p<=r||r>n&&p>=r)&&(clearInterval(e._interval),e._interval=null,e._fadeTo=null,u.volume(r,e._id),u._emit("fade",e._id))},S)},_stopFade:function(e){var n=this,r=n._soundById(e);return r&&r._interval&&(n._webAudio&&r._node.gain.cancelScheduledValues(t.ctx.currentTime),clearInterval(r._interval),r._interval=null,n.volume(r._fadeTo,e),r._fadeTo=null,n._emit("fade",e)),n},loop:function(){var e=this,n=arguments,r,l,d;if(n.length===0)return e._loop;if(n.length===1)if(typeof n[0]=="boolean")r=n[0],e._loop=r;else return d=e._soundById(parseInt(n[0],10)),d?d._loop:!1;else n.length===2&&(r=n[0],l=parseInt(n[1],10));for(var _=e._getSoundIds(l),u=0;u<_.length;u++)d=e._soundById(_[u]),d&&(d._loop=r,e._webAudio&&d._node&&d._node.bufferSource&&(d._node.bufferSource.loop=r,r&&(d._node.bufferSource.loopStart=d._start||0,d._node.bufferSource.loopEnd=d._stop,e.playing(_[u])&&(e.pause(_[u],!0),e.play(_[u],!0)))));return e},rate:function(){var e=this,n=arguments,r,l;if(n.length===0)l=e._sounds[0]._id;else if(n.length===1){var d=e._getSoundIds(),_=d.indexOf(n[0]);_>=0?l=parseInt(n[0],10):r=parseFloat(n[0])}else n.length===2&&(r=parseFloat(n[0]),l=parseInt(n[1],10));var u;if(typeof r=="number"){if(e._state!=="loaded"||e._playLock)return e._queue.push({event:"rate",action:function(){e.rate.apply(e,n)}}),e;typeof l>"u"&&(e._rate=r),l=e._getSoundIds(l);for(var p=0;p<l.length;p++)if(u=e._soundById(l[p]),u){e.playing(l[p])&&(u._rateSeek=e.seek(l[p]),u._playStart=e._webAudio?t.ctx.currentTime:u._playStart),u._rate=r,e._webAudio&&u._node&&u._node.bufferSource?u._node.bufferSource.playbackRate.setValueAtTime(r,t.ctx.currentTime):u._node&&(u._node.playbackRate=r);var g=e.seek(l[p]),T=(e._sprite[u._sprite][0]+e._sprite[u._sprite][1])/1e3-g,S=T*1e3/Math.abs(u._rate);(e._endTimers[l[p]]||!u._paused)&&(e._clearTimer(l[p]),e._endTimers[l[p]]=setTimeout(e._ended.bind(e,u),S)),e._emit("rate",u._id)}}else return u=e._soundById(l),u?u._rate:e._rate;return e},seek:function(){var e=this,n=arguments,r,l;if(n.length===0)e._sounds.length&&(l=e._sounds[0]._id);else if(n.length===1){var d=e._getSoundIds(),_=d.indexOf(n[0]);_>=0?l=parseInt(n[0],10):e._sounds.length&&(l=e._sounds[0]._id,r=parseFloat(n[0]))}else n.length===2&&(r=parseFloat(n[0]),l=parseInt(n[1],10));if(typeof l>"u")return 0;if(typeof r=="number"&&(e._state!=="loaded"||e._playLock))return e._queue.push({event:"seek",action:function(){e.seek.apply(e,n)}}),e;var u=e._soundById(l);if(u)if(typeof r=="number"&&r>=0){var p=e.playing(l);p&&e.pause(l,!0),u._seek=r,u._ended=!1,e._clearTimer(l),!e._webAudio&&u._node&&!isNaN(u._node.duration)&&(u._node.currentTime=r);var g=function(){p&&e.play(l,!0),e._emit("seek",l)};if(p&&!e._webAudio){var T=function(){e._playLock?setTimeout(T,0):g()};setTimeout(T,0)}else g()}else if(e._webAudio){var S=e.playing(l)?t.ctx.currentTime-u._playStart:0,L=u._rateSeek?u._rateSeek-u._seek:0;return u._seek+(L+S*Math.abs(u._rate))}else return u._node.currentTime;return e},playing:function(e){var n=this;if(typeof e=="number"){var r=n._soundById(e);return r?!r._paused:!1}for(var l=0;l<n._sounds.length;l++)if(!n._sounds[l]._paused)return!0;return!1},duration:function(e){var n=this,r=n._duration,l=n._soundById(e);return l&&(r=n._sprite[l._sprite][1]/1e3),r},state:function(){return this._state},unload:function(){for(var e=this,n=e._sounds,r=0;r<n.length;r++)n[r]._paused||e.stop(n[r]._id),e._webAudio||(e._clearSound(n[r]._node),n[r]._node.removeEventListener("error",n[r]._errorFn,!1),n[r]._node.removeEventListener(t._canPlayEvent,n[r]._loadFn,!1),n[r]._node.removeEventListener("ended",n[r]._endFn,!1),t._releaseHtml5Audio(n[r]._node)),delete n[r]._node,e._clearTimer(n[r]._id);var l=t._howls.indexOf(e);l>=0&&t._howls.splice(l,1);var d=!0;for(r=0;r<t._howls.length;r++)if(t._howls[r]._src===e._src||e._src.indexOf(t._howls[r]._src)>=0){d=!1;break}return f&&d&&delete f[e._src],t.noAudio=!1,e._state="unloaded",e._sounds=[],e=null,null},on:function(e,n,r,l){var d=this,_=d["_on"+e];return typeof n=="function"&&_.push(l?{id:r,fn:n,once:l}:{id:r,fn:n}),d},off:function(e,n,r){var l=this,d=l["_on"+e],_=0;if(typeof n=="number"&&(r=n,n=null),n||r)for(_=0;_<d.length;_++){var u=r===d[_].id;if(n===d[_].fn&&u||!n&&u){d.splice(_,1);break}}else if(e)l["_on"+e]=[];else{var p=Object.keys(l);for(_=0;_<p.length;_++)p[_].indexOf("_on")===0&&Array.isArray(l[p[_]])&&(l[p[_]]=[])}return l},once:function(e,n,r){var l=this;return l.on(e,n,r,1),l},_emit:function(e,n,r){for(var l=this,d=l["_on"+e],_=d.length-1;_>=0;_--)(!d[_].id||d[_].id===n||e==="load")&&(setTimeout((function(u){u.call(this,n,r)}).bind(l,d[_].fn),0),d[_].once&&l.off(e,d[_].fn,d[_].id));return l._loadQueue(e),l},_loadQueue:function(e){var n=this;if(n._queue.length>0){var r=n._queue[0];r.event===e&&(n._queue.shift(),n._loadQueue()),e||r.action()}return n},_ended:function(e){var n=this,r=e._sprite;if(!n._webAudio&&e._node&&!e._node.paused&&!e._node.ended&&e._node.currentTime<e._stop)return setTimeout(n._ended.bind(n,e),100),n;var l=!!(e._loop||n._sprite[r][2]);if(n._emit("end",e._id),!n._webAudio&&l&&n.stop(e._id,!0).play(e._id),n._webAudio&&l){n._emit("play",e._id),e._seek=e._start||0,e._rateSeek=0,e._playStart=t.ctx.currentTime;var d=(e._stop-e._start)*1e3/Math.abs(e._rate);n._endTimers[e._id]=setTimeout(n._ended.bind(n,e),d)}return n._webAudio&&!l&&(e._paused=!0,e._ended=!0,e._seek=e._start||0,e._rateSeek=0,n._clearTimer(e._id),n._cleanBuffer(e._node),t._autoSuspend()),!n._webAudio&&!l&&n.stop(e._id,!0),n},_clearTimer:function(e){var n=this;if(n._endTimers[e]){if(typeof n._endTimers[e]!="function")clearTimeout(n._endTimers[e]);else{var r=n._soundById(e);r&&r._node&&r._node.removeEventListener("ended",n._endTimers[e],!1)}delete n._endTimers[e]}return n},_soundById:function(e){for(var n=this,r=0;r<n._sounds.length;r++)if(e===n._sounds[r]._id)return n._sounds[r];return null},_inactiveSound:function(){var e=this;e._drain();for(var n=0;n<e._sounds.length;n++)if(e._sounds[n]._ended)return e._sounds[n].reset();return new a(e)},_drain:function(){var e=this,n=e._pool,r=0,l=0;if(!(e._sounds.length<n)){for(l=0;l<e._sounds.length;l++)e._sounds[l]._ended&&r++;for(l=e._sounds.length-1;l>=0;l--){if(r<=n)return;e._sounds[l]._ended&&(e._webAudio&&e._sounds[l]._node&&e._sounds[l]._node.disconnect(0),e._sounds.splice(l,1),r--)}}},_getSoundIds:function(e){var n=this;if(typeof e>"u"){for(var r=[],l=0;l<n._sounds.length;l++)r.push(n._sounds[l]._id);return r}else return[e]},_refreshBuffer:function(e){var n=this;return e._node.bufferSource=t.ctx.createBufferSource(),e._node.bufferSource.buffer=f[n._src],e._panner?e._node.bufferSource.connect(e._panner):e._node.bufferSource.connect(e._node),e._node.bufferSource.loop=e._loop,e._loop&&(e._node.bufferSource.loopStart=e._start||0,e._node.bufferSource.loopEnd=e._stop||0),e._node.bufferSource.playbackRate.setValueAtTime(e._rate,t.ctx.currentTime),n},_cleanBuffer:function(e){var n=this,r=t._navigator&&t._navigator.vendor.indexOf("Apple")>=0;if(t._scratchBuffer&&e.bufferSource&&(e.bufferSource.onended=null,e.bufferSource.disconnect(0),r))try{e.bufferSource.buffer=t._scratchBuffer}catch{}return e.bufferSource=null,n},_clearSound:function(e){var n=/MSIE |Trident\//.test(t._navigator&&t._navigator.userAgent);n||(e.src="data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA")}};var a=function(e){this._parent=e,this.init()};a.prototype={init:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,n._sounds.push(e),e.create(),e},create:function(){var e=this,n=e._parent,r=t._muted||e._muted||e._parent._muted?0:e._volume;return n._webAudio?(e._node=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),e._node.gain.setValueAtTime(r,t.ctx.currentTime),e._node.paused=!0,e._node.connect(t.masterGain)):t.noAudio||(e._node=t._obtainHtml5Audio(),e._errorFn=e._errorListener.bind(e),e._node.addEventListener("error",e._errorFn,!1),e._loadFn=e._loadListener.bind(e),e._node.addEventListener(t._canPlayEvent,e._loadFn,!1),e._endFn=e._endListener.bind(e),e._node.addEventListener("ended",e._endFn,!1),e._node.src=n._src,e._node.preload=n._preload===!0?"auto":n._preload,e._node.volume=r*t.volume(),e._node.load()),e},reset:function(){var e=this,n=e._parent;return e._muted=n._muted,e._loop=n._loop,e._volume=n._volume,e._rate=n._rate,e._seek=0,e._rateSeek=0,e._paused=!0,e._ended=!0,e._sprite="__default",e._id=++t._counter,e},_errorListener:function(){var e=this;e._parent._emit("loaderror",e._id,e._node.error?e._node.error.code:0),e._node.removeEventListener("error",e._errorFn,!1)},_loadListener:function(){var e=this,n=e._parent;n._duration=Math.ceil(e._node.duration*10)/10,Object.keys(n._sprite).length===0&&(n._sprite={__default:[0,n._duration*1e3]}),n._state!=="loaded"&&(n._state="loaded",n._emit("load"),n._loadQueue()),e._node.removeEventListener(t._canPlayEvent,e._loadFn,!1)},_endListener:function(){var e=this,n=e._parent;n._duration===1/0&&(n._duration=Math.ceil(e._node.duration*10)/10,n._sprite.__default[1]===1/0&&(n._sprite.__default[1]=n._duration*1e3),n._ended(e)),e._node.removeEventListener("ended",e._endFn,!1)}};var f={},c=function(e){var n=e._src;if(f[n]){e._duration=f[n].duration,h(e);return}if(/^data:[^;]+;base64,/.test(n)){for(var r=atob(n.split(",")[1]),l=new Uint8Array(r.length),d=0;d<r.length;++d)l[d]=r.charCodeAt(d);m(l.buffer,e)}else{var _=new XMLHttpRequest;_.open(e._xhr.method,n,!0),_.withCredentials=e._xhr.withCredentials,_.responseType="arraybuffer",e._xhr.headers&&Object.keys(e._xhr.headers).forEach(function(u){_.setRequestHeader(u,e._xhr.headers[u])}),_.onload=function(){var u=(_.status+"")[0];if(u!=="0"&&u!=="2"&&u!=="3"){e._emit("loaderror",null,"Failed loading audio file with status: "+_.status+".");return}m(_.response,e)},_.onerror=function(){e._webAudio&&(e._html5=!0,e._webAudio=!1,e._sounds=[],delete f[n],e.load())},v(_)}},v=function(e){try{e.send()}catch{e.onerror()}},m=function(e,n){var r=function(){n._emit("loaderror",null,"Decoding audio data failed.")},l=function(d){d&&n._sounds.length>0?(f[n._src]=d,h(n,d)):r()};typeof Promise<"u"&&t.ctx.decodeAudioData.length===1?t.ctx.decodeAudioData(e).then(l).catch(r):t.ctx.decodeAudioData(e,l,r)},h=function(e,n){n&&!e._duration&&(e._duration=n.duration),Object.keys(e._sprite).length===0&&(e._sprite={__default:[0,e._duration*1e3]}),e._state!=="loaded"&&(e._state="loaded",e._emit("load"),e._loadQueue())},x=function(){if(t.usingWebAudio){try{typeof AudioContext<"u"?t.ctx=new AudioContext:typeof webkitAudioContext<"u"?t.ctx=new webkitAudioContext:t.usingWebAudio=!1}catch{t.usingWebAudio=!1}t.ctx||(t.usingWebAudio=!1);var e=/iP(hone|od|ad)/.test(t._navigator&&t._navigator.platform),n=t._navigator&&t._navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/),r=n?parseInt(n[1],10):null;if(e&&r&&r<9){var l=/safari/.test(t._navigator&&t._navigator.userAgent.toLowerCase());t._navigator&&!l&&(t.usingWebAudio=!1)}t.usingWebAudio&&(t.masterGain=typeof t.ctx.createGain>"u"?t.ctx.createGainNode():t.ctx.createGain(),t.masterGain.gain.setValueAtTime(t._muted?0:t._volume,t.ctx.currentTime),t.masterGain.connect(t.ctx.destination)),t._setup()}};s.Howler=t,s.Howl=i,typeof P<"u"?(P.HowlerGlobal=o,P.Howler=t,P.Howl=i,P.Sound=a):typeof window<"u"&&(window.HowlerGlobal=o,window.Howler=t,window.Howl=i,window.Sound=a)})();/*!
 *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.
 *  
 *  howler.js v2.2.3
 *  howlerjs.com
 *
 *  (c) 2013-2020, James Simpson of GoldFire Studios
 *  goldfirestudios.com
 *
 *  MIT License
 */(function(){HowlerGlobal.prototype._pos=[0,0,0],HowlerGlobal.prototype._orientation=[0,0,-1,0,1,0],HowlerGlobal.prototype.stereo=function(t){var i=this;if(!i.ctx||!i.ctx.listener)return i;for(var a=i._howls.length-1;a>=0;a--)i._howls[a].stereo(t);return i},HowlerGlobal.prototype.pos=function(t,i,a){var f=this;if(!f.ctx||!f.ctx.listener)return f;if(i=typeof i!="number"?f._pos[1]:i,a=typeof a!="number"?f._pos[2]:a,typeof t=="number")f._pos=[t,i,a],typeof f.ctx.listener.positionX<"u"?(f.ctx.listener.positionX.setTargetAtTime(f._pos[0],Howler.ctx.currentTime,.1),f.ctx.listener.positionY.setTargetAtTime(f._pos[1],Howler.ctx.currentTime,.1),f.ctx.listener.positionZ.setTargetAtTime(f._pos[2],Howler.ctx.currentTime,.1)):f.ctx.listener.setPosition(f._pos[0],f._pos[1],f._pos[2]);else return f._pos;return f},HowlerGlobal.prototype.orientation=function(t,i,a,f,c,v){var m=this;if(!m.ctx||!m.ctx.listener)return m;var h=m._orientation;if(i=typeof i!="number"?h[1]:i,a=typeof a!="number"?h[2]:a,f=typeof f!="number"?h[3]:f,c=typeof c!="number"?h[4]:c,v=typeof v!="number"?h[5]:v,typeof t=="number")m._orientation=[t,i,a,f,c,v],typeof m.ctx.listener.forwardX<"u"?(m.ctx.listener.forwardX.setTargetAtTime(t,Howler.ctx.currentTime,.1),m.ctx.listener.forwardY.setTargetAtTime(i,Howler.ctx.currentTime,.1),m.ctx.listener.forwardZ.setTargetAtTime(a,Howler.ctx.currentTime,.1),m.ctx.listener.upX.setTargetAtTime(f,Howler.ctx.currentTime,.1),m.ctx.listener.upY.setTargetAtTime(c,Howler.ctx.currentTime,.1),m.ctx.listener.upZ.setTargetAtTime(v,Howler.ctx.currentTime,.1)):m.ctx.listener.setOrientation(t,i,a,f,c,v);else return h;return m},Howl.prototype.init=function(t){return function(i){var a=this;return a._orientation=i.orientation||[1,0,0],a._stereo=i.stereo||null,a._pos=i.pos||null,a._pannerAttr={coneInnerAngle:typeof i.coneInnerAngle<"u"?i.coneInnerAngle:360,coneOuterAngle:typeof i.coneOuterAngle<"u"?i.coneOuterAngle:360,coneOuterGain:typeof i.coneOuterGain<"u"?i.coneOuterGain:0,distanceModel:typeof i.distanceModel<"u"?i.distanceModel:"inverse",maxDistance:typeof i.maxDistance<"u"?i.maxDistance:1e4,panningModel:typeof i.panningModel<"u"?i.panningModel:"HRTF",refDistance:typeof i.refDistance<"u"?i.refDistance:1,rolloffFactor:typeof i.rolloffFactor<"u"?i.rolloffFactor:1},a._onstereo=i.onstereo?[{fn:i.onstereo}]:[],a._onpos=i.onpos?[{fn:i.onpos}]:[],a._onorientation=i.onorientation?[{fn:i.onorientation}]:[],t.call(this,i)}}(Howl.prototype.init),Howl.prototype.stereo=function(t,i){var a=this;if(!a._webAudio)return a;if(a._state!=="loaded")return a._queue.push({event:"stereo",action:function(){a.stereo(t,i)}}),a;var f=typeof Howler.ctx.createStereoPanner>"u"?"spatial":"stereo";if(typeof i>"u")if(typeof t=="number")a._stereo=t,a._pos=[t,0,0];else return a._stereo;for(var c=a._getSoundIds(i),v=0;v<c.length;v++){var m=a._soundById(c[v]);if(m)if(typeof t=="number")m._stereo=t,m._pos=[t,0,0],m._node&&(m._pannerAttr.panningModel="equalpower",(!m._panner||!m._panner.pan)&&o(m,f),f==="spatial"?typeof m._panner.positionX<"u"?(m._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),m._panner.positionY.setValueAtTime(0,Howler.ctx.currentTime),m._panner.positionZ.setValueAtTime(0,Howler.ctx.currentTime)):m._panner.setPosition(t,0,0):m._panner.pan.setValueAtTime(t,Howler.ctx.currentTime)),a._emit("stereo",m._id);else return m._stereo}return a},Howl.prototype.pos=function(t,i,a,f){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"pos",action:function(){c.pos(t,i,a,f)}}),c;if(i=typeof i!="number"?0:i,a=typeof a!="number"?-.5:a,typeof f>"u")if(typeof t=="number")c._pos=[t,i,a];else return c._pos;for(var v=c._getSoundIds(f),m=0;m<v.length;m++){var h=c._soundById(v[m]);if(h)if(typeof t=="number")h._pos=[t,i,a],h._node&&((!h._panner||h._panner.pan)&&o(h,"spatial"),typeof h._panner.positionX<"u"?(h._panner.positionX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.positionY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.positionZ.setValueAtTime(a,Howler.ctx.currentTime)):h._panner.setPosition(t,i,a)),c._emit("pos",h._id);else return h._pos}return c},Howl.prototype.orientation=function(t,i,a,f){var c=this;if(!c._webAudio)return c;if(c._state!=="loaded")return c._queue.push({event:"orientation",action:function(){c.orientation(t,i,a,f)}}),c;if(i=typeof i!="number"?c._orientation[1]:i,a=typeof a!="number"?c._orientation[2]:a,typeof f>"u")if(typeof t=="number")c._orientation=[t,i,a];else return c._orientation;for(var v=c._getSoundIds(f),m=0;m<v.length;m++){var h=c._soundById(v[m]);if(h)if(typeof t=="number")h._orientation=[t,i,a],h._node&&(h._panner||(h._pos||(h._pos=c._pos||[0,0,-.5]),o(h,"spatial")),typeof h._panner.orientationX<"u"?(h._panner.orientationX.setValueAtTime(t,Howler.ctx.currentTime),h._panner.orientationY.setValueAtTime(i,Howler.ctx.currentTime),h._panner.orientationZ.setValueAtTime(a,Howler.ctx.currentTime)):h._panner.setOrientation(t,i,a)),c._emit("orientation",h._id);else return h._orientation}return c},Howl.prototype.pannerAttr=function(){var t=this,i=arguments,a,f,c;if(!t._webAudio)return t;if(i.length===0)return t._pannerAttr;if(i.length===1)if(typeof i[0]=="object")a=i[0],typeof f>"u"&&(a.pannerAttr||(a.pannerAttr={coneInnerAngle:a.coneInnerAngle,coneOuterAngle:a.coneOuterAngle,coneOuterGain:a.coneOuterGain,distanceModel:a.distanceModel,maxDistance:a.maxDistance,refDistance:a.refDistance,rolloffFactor:a.rolloffFactor,panningModel:a.panningModel}),t._pannerAttr={coneInnerAngle:typeof a.pannerAttr.coneInnerAngle<"u"?a.pannerAttr.coneInnerAngle:t._coneInnerAngle,coneOuterAngle:typeof a.pannerAttr.coneOuterAngle<"u"?a.pannerAttr.coneOuterAngle:t._coneOuterAngle,coneOuterGain:typeof a.pannerAttr.coneOuterGain<"u"?a.pannerAttr.coneOuterGain:t._coneOuterGain,distanceModel:typeof a.pannerAttr.distanceModel<"u"?a.pannerAttr.distanceModel:t._distanceModel,maxDistance:typeof a.pannerAttr.maxDistance<"u"?a.pannerAttr.maxDistance:t._maxDistance,refDistance:typeof a.pannerAttr.refDistance<"u"?a.pannerAttr.refDistance:t._refDistance,rolloffFactor:typeof a.pannerAttr.rolloffFactor<"u"?a.pannerAttr.rolloffFactor:t._rolloffFactor,panningModel:typeof a.pannerAttr.panningModel<"u"?a.pannerAttr.panningModel:t._panningModel});else return c=t._soundById(parseInt(i[0],10)),c?c._pannerAttr:t._pannerAttr;else i.length===2&&(a=i[0],f=parseInt(i[1],10));for(var v=t._getSoundIds(f),m=0;m<v.length;m++)if(c=t._soundById(v[m]),c){var h=c._pannerAttr;h={coneInnerAngle:typeof a.coneInnerAngle<"u"?a.coneInnerAngle:h.coneInnerAngle,coneOuterAngle:typeof a.coneOuterAngle<"u"?a.coneOuterAngle:h.coneOuterAngle,coneOuterGain:typeof a.coneOuterGain<"u"?a.coneOuterGain:h.coneOuterGain,distanceModel:typeof a.distanceModel<"u"?a.distanceModel:h.distanceModel,maxDistance:typeof a.maxDistance<"u"?a.maxDistance:h.maxDistance,refDistance:typeof a.refDistance<"u"?a.refDistance:h.refDistance,rolloffFactor:typeof a.rolloffFactor<"u"?a.rolloffFactor:h.rolloffFactor,panningModel:typeof a.panningModel<"u"?a.panningModel:h.panningModel};var x=c._panner;x?(x.coneInnerAngle=h.coneInnerAngle,x.coneOuterAngle=h.coneOuterAngle,x.coneOuterGain=h.coneOuterGain,x.distanceModel=h.distanceModel,x.maxDistance=h.maxDistance,x.refDistance=h.refDistance,x.rolloffFactor=h.rolloffFactor,x.panningModel=h.panningModel):(c._pos||(c._pos=t._pos||[0,0,-.5]),o(c,"spatial"))}return t},Sound.prototype.init=function(t){return function(){var i=this,a=i._parent;i._orientation=a._orientation,i._stereo=a._stereo,i._pos=a._pos,i._pannerAttr=a._pannerAttr,t.call(this),i._stereo?a.stereo(i._stereo):i._pos&&a.pos(i._pos[0],i._pos[1],i._pos[2],i._id)}}(Sound.prototype.init),Sound.prototype.reset=function(t){return function(){var i=this,a=i._parent;return i._orientation=a._orientation,i._stereo=a._stereo,i._pos=a._pos,i._pannerAttr=a._pannerAttr,i._stereo?a.stereo(i._stereo):i._pos?a.pos(i._pos[0],i._pos[1],i._pos[2],i._id):i._panner&&(i._panner.disconnect(0),i._panner=void 0,a._refreshBuffer(i)),t.call(this)}}(Sound.prototype.reset);var o=function(t,i){i=i||"spatial",i==="spatial"?(t._panner=Howler.ctx.createPanner(),t._panner.coneInnerAngle=t._pannerAttr.coneInnerAngle,t._panner.coneOuterAngle=t._pannerAttr.coneOuterAngle,t._panner.coneOuterGain=t._pannerAttr.coneOuterGain,t._panner.distanceModel=t._pannerAttr.distanceModel,t._panner.maxDistance=t._pannerAttr.maxDistance,t._panner.refDistance=t._pannerAttr.refDistance,t._panner.rolloffFactor=t._pannerAttr.rolloffFactor,t._panner.panningModel=t._pannerAttr.panningModel,typeof t._panner.positionX<"u"?(t._panner.positionX.setValueAtTime(t._pos[0],Howler.ctx.currentTime),t._panner.positionY.setValueAtTime(t._pos[1],Howler.ctx.currentTime),t._panner.positionZ.setValueAtTime(t._pos[2],Howler.ctx.currentTime)):t._panner.setPosition(t._pos[0],t._pos[1],t._pos[2]),typeof t._panner.orientationX<"u"?(t._panner.orientationX.setValueAtTime(t._orientation[0],Howler.ctx.currentTime),t._panner.orientationY.setValueAtTime(t._orientation[1],Howler.ctx.currentTime),t._panner.orientationZ.setValueAtTime(t._orientation[2],Howler.ctx.currentTime)):t._panner.setOrientation(t._orientation[0],t._orientation[1],t._orientation[2])):(t._panner=Howler.ctx.createStereoPanner(),t._panner.pan.setValueAtTime(t._stereo,Howler.ctx.currentTime)),t._panner.connect(t._node),t._paused||t._parent.pause(t._id,!0).play(t._id,!0)}})()})(C);const ue=new C.Howl({src:["./src/sounds/mp3/original-theme.mp3"],loop:!0,volume:.2}),Te=new C.Howl({src:["./src/sounds/mp3/fx-lock.mp3"],volume:.15}),U=new C.Howl({src:["./src/sounds/mp3/fx-fall.mp3"],volume:1,onplayerror:function(){U.once("unlock",function(){U.play()})}}),be=new C.Howl({src:["./src/sounds/mp3/fx-hard-drop.mp3"],volume:.3}),xe=new C.Howl({src:["./src/sounds/mp3/fx-rotate.mp3"],volume:.7});new C.Howl({src:["./src/sounds/mp3/fx-short.mp3"],volume:1});class q{constructor(o,t){w(this,"_matrix");w(this,"_color");w(this,"_darkColor");w(this,"_lightColor");w(this,"_rowIndex");w(this,"_columnIndex");w(this,"_width");w(this,"_height");w(this,"_moveLeft");w(this,"_moveRight");w(this,"_moveDown");w(this,"_rotate");w(this,"_gameField");w(this,"_mergeFunc");w(this,"_eventHandlerKeydown",o=>{(o.keyCode===37||o.keyCode===65)&&(this._moveLeft=!0),(o.keyCode===39||o.keyCode===68)&&(this._moveRight=!0),(o.keyCode===40||o.keyCode===83)&&(this._moveDown=!0),(o.keyCode===38||o.keyCode===87)&&(this._rotate=!0)});w(this,"_eventHandlerKeyup",o=>{(o.keyCode===37||o.keyCode===65)&&(this._moveLeft=!1),(o.keyCode===39||o.keyCode===68)&&(this._moveRight=!1),(o.keyCode===40||o.keyCode===83)&&(this._moveDown=!1),(o.keyCode===38||o.keyCode===87)&&(this._rotate=!1)});this._gameField=o,this._mergeFunc=t,this._matrix=ie[re(0,ie.length-1)];const i=le[re(0,le.length-1)];this._color=i[0],this._darkColor=i[1],this._lightColor=i[2],this._height=0,this._width=0,this._rowIndex=oe,this._columnIndex=ae,this._moveLeft=!1,this._moveRight=!1,this._moveDown=!1,this._rotate=!1,this._calcSize(),document.addEventListener("keydown",this._eventHandlerKeydown),document.addEventListener("keyup",this._eventHandlerKeyup)}_calcSize(){const o=this._matrix.map(t=>t.map((i,a)=>i===1?a+1:0)).filter(t=>t.length!==0).flatMap(t=>t);this._width=Math.max(...o),this._height=this._matrix.filter(t=>t.some(i=>i===1)).length}_checkAndNormalize(){for(;this._matrix[0].every(o=>o===0);)this._matrix=this._matrix.slice(1).concat([new Array(this._matrix.length).fill(0)]);for(;this._matrix.every(o=>o[0]===0);)this._matrix=this._matrix.map(o=>o.slice(1).concat([0]))}move(){if(this._moveLeft&&(this._columnIndex>0&&(--this._columnIndex,this._gameField.isCollision(this)&&++this._columnIndex),this._moveLeft=!1),this._moveRight&&(this._columnIndex+this._width<k&&(++this._columnIndex,this._gameField.isCollision(this)&&--this._columnIndex),this._moveRight=!1),this._moveDown&&(this._rowIndex+this._height<G&&(++this._rowIndex,this._gameField.isCollision(this)&&(--this._rowIndex,be.play(),this._mergeFunc(),this._rowIndex=oe,this._columnIndex=ae)),this._moveDown=!1),this._rotate){if(this._rowIndex>=0){const o=this._matrix;this.rotate(),this._rowIndex+this._height>=G||this._columnIndex+this._width>=k||this._gameField.isCollision(this)?(this._matrix=o,this._calcSize()):xe.play()}this._rotate=!1}}get matrix(){return this._matrix}get color(){return this._color}get darkColor(){return this._darkColor}get lightColor(){return this._lightColor}get rowIndex(){return this._rowIndex}get columnIndex(){return this._columnIndex}get width(){return this._width}get height(){return this._height}get isMovingDown(){return this._moveDown}get isMoving(){return this._moveDown||this._moveLeft||this._moveRight||this._rotate}moveUp(){--this._rowIndex}moveDown(){++this._rowIndex}rotate(){this._matrix=ge(this._matrix),this._checkAndNormalize(),this._calcSize()}}class Ie{constructor(){w(this,"_coloredMatrix");this._coloredMatrix=[],this.reset()}reset(){this._coloredMatrix.length>0&&this._coloredMatrix.splice(0,this._coloredMatrix.length);for(let o=0;o<G;++o)this._coloredMatrix.push(new Array(k).fill({color:"",darkColor:"",lightColor:"",value:0}))}merge(o){o.matrix.forEach((t,i)=>{t.forEach((a,f)=>{const c=o.rowIndex+i;if(a===1&&c>=0){const v=f+o.columnIndex;this._coloredMatrix[c][v]={color:o.color,darkColor:o.darkColor,lightColor:o.lightColor,value:1}}})})}isCollision(o){for(let t=0;t<o.matrix.length;++t)for(let i=0;i<o.matrix[t].length;++i){if(o.rowIndex<0)continue;const a=t+o.rowIndex,f=i+o.columnIndex;if(o.matrix[t][i]===1&&this._coloredMatrix[a][f].value===1)return!0}return!1}hasFullRows(){return!!this._coloredMatrix.some(o=>o.every(t=>t.value===1))}getFullRowIndexes(){return this._coloredMatrix.map((t,i)=>t.every(a=>(a==null?void 0:a.value)===1)?i:0).filter(t=>t>0)}getFullRowsCount(){return this.getFullRowIndexes().length}removeRowCell(o,t){this._coloredMatrix[o][t]={color:"",darkColor:"",lightColor:"",value:0}}shiftEmptyRows(o){this._coloredMatrix.splice(o,1),this._coloredMatrix.unshift(new Array(k).fill({color:"",darkColor:"",lightColor:"",value:0}))}isOver(){return this._coloredMatrix[0].some(o=>o.value===1)}get coloredMatrix(){return this._coloredMatrix}}class Se{constructor(o){w(this,"canvas");w(this,"_context");w(this,"_gameField");w(this,"_nextFigureField");w(this,"_scoreField");w(this,"_soundButtonField");w(this,"_textInfo");w(this,"_secondaryTextInfo");w(this,"_gameSquare");w(this,"_isMutedSound",!1);w(this,"_mouseClickEventHandler",o=>{const t=this.canvas.getBoundingClientRect(),i=o.clientX-t.left,a=o.clientY-t.top,f=i>this._soundButtonField.positionX&&i<this._soundButtonField.positionX+this._soundButtonField.width&&a>this._soundButtonField.positionY&&a<this._soundButtonField.positionY+this._soundButtonField.height;this._isMutedSound=f?!this._isMutedSound:this._isMutedSound,f&&(this._clearSoundButton(),C.Howler.mute(this._isMutedSound),this.drawSoundControl())});this.canvas=document.querySelector(o),this._context=this.canvas.getContext("2d");const t=Math.round(this.canvas.width/2);this._gameField={positionX:Math.round(this.canvas.width/2)-Math.round(t/2),positionY:Math.round(this.canvas.height/2)-Math.round(t/2)*2,width:t,height:t*2},this._nextFigureField={positionX:this._gameField.positionX+this._gameField.width+Math.round(t/8),positionY:this._gameField.positionY+Math.round(t/8),width:Math.round(t/4),height:Math.round(t/4)*2},this._scoreField={positionX:12,positionY:this._nextFigureField.positionY-28,width:Math.round(this.canvas.width/4)-18,height:this._gameField.height},this._textInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2),fontSize:Math.round(this.canvas.width/18),font:"",align:"center"},this._textInfo.font=`bold ${this._textInfo.fontSize}px Cascadia Mono SemiBold`,this._secondaryTextInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2)+Math.round(this.canvas.height/7),fontSize:Math.round(this.canvas.width/22),font:"",align:"center"},this._secondaryTextInfo.font=`bold ${this._secondaryTextInfo.fontSize}px Cascadia Mono SemiBold`,this._gameSquare={width:Math.round(t/k)-M,height:Math.round(this._gameField.height/G)-M},this._soundButtonField={positionX:this.canvas.width-68,positionY:this.canvas.height-72,width:56,height:56},this._drawSoundButton(),this.canvas.addEventListener("click",this._mouseClickEventHandler)}drawSoundControl(){if(this._isMutedSound){this._drawMutedSoundButton();return}this._drawSoundButton()}_clearSoundButton(){H(this._context,this._soundButtonField)}_drawSoundButton(){ve(this._context,this.canvas.width-64,this.canvas.height-64,F,.1)}_drawMutedSoundButton(){me(this._context,this.canvas.width-60,this.canvas.height-58,F,.1)}clear(){H(this._context,{positionX:0,positionY:0,width:this.canvas.width,height:this.canvas.height})}clearGameField(){H(this._context,this._gameField)}cleartNextFigure(){H(this._context,this._nextFigureField)}clearScoreInfo(){H(this._context,this._scoreField)}drawScoreInfo(o,t,i){const a={...this._secondaryTextInfo};a.positionX=12,a.positionY=this._nextFigureField.positionY-20,a.font="bold 16px Cascadia Mono SemiBold",a.align="left",E(this._context,a,F,"SCORE:"),a.font="bold 20px Cascadia Mono SemiBold",a.positionY+=40,E(this._context,a,F,`${i}`.padStart(9,"0")),a.positionY+=80,a.font="bold 16px Cascadia Mono SemiBold",E(this._context,a,F,`LEVEL: ${o}`),a.positionY+=80,E(this._context,a,F,`LINES: ${t}`)}drawNextFigureField(){const o={...this._secondaryTextInfo};o.positionX=this._nextFigureField.positionX,o.positionY=this._nextFigureField.positionY-20,o.font="bold 16px Cascadia Mono SemiBold",o.align="left",E(this._context,o,F,"N E X T:");for(let t=1;t<3;++t)ne(this._context,F,this._nextFigureField.positionX-t,this._nextFigureField.positionY-t,this._nextFigureField.width+t*2,this._nextFigureField.height+t*2)}drawGameField(){for(let o=1;o<4;++o)ne(this._context,F,this._gameField.positionX-M-o,this._gameField.positionY-M-o,this._gameField.width+M+o*2,this._gameField.height+M+o*2)}drawNextFigure(o){const t=Math.round(this._nextFigureField.width/5)-1;o.matrix.forEach((i,a)=>{i.forEach((f,c)=>{if(f===1){const v=this._nextFigureField.positionX+(c+1)*(t+1),m=this._nextFigureField.positionY+(a+3)*(t+1);j(this._context,o.color,v,m,t,t)}})})}drawGameFigure(o){o.matrix.forEach((t,i)=>{t.forEach((a,f)=>{a===1&&this.drawGameSquare(o.columnIndex+f,o.rowIndex+i,o.color,o.darkColor,o.lightColor)})})}drawGameSquare(o,t,i,a,f){if(t<0)return;const c=this._gameField.positionX+(this._gameSquare.width+M)*o,v=this._gameField.positionY+(this._gameSquare.height+M)*t;j(this._context,i,c,v,this._gameSquare.width,this._gameSquare.height),pe(this._context,a,f,c,v,this._gameSquare.width,this._gameSquare.height)}drawFieldMatrix(o){o.coloredMatrix.forEach((t,i)=>{t.forEach((a,f)=>{(a==null?void 0:a.value)===1&&this.drawGameSquare(f,i,a==null?void 0:a.color,a==null?void 0:a.darkColor,a==null?void 0:a.lightColor)})})}drawInfo(o,t){j(this._context,"#0a0a0a",this._textInfo.positionX-Math.round(this.canvas.width/3),this._textInfo.positionY-Math.round(this.canvas.height/8),Math.round(this.canvas.width/1.5),Math.round(this.canvas.height/3)),E(this._context,this._textInfo,t,o)}drawSecondaryInfo(o,t){E(this._context,this._secondaryTextInfo,t,o)}}const A=new Se(we),b=new Ie;let D=new q(b,B),I=new q(b,B),V=0,$=1,W=0,Q=0,N=!1,Z=0,O=[],se=0,z=!1;function de(){if(A.clearGameField(),N&&++se>10?(O.some(s=>s.columnsCount>0)?(O.forEach((s,o)=>{if(o===0||O[o-1].columnsCount<k-2){const t=k-Math.floor(s.columnsCount/2),i=Math.floor(s.columnsCount/2)-1;s.columnsCount>0&&(b.removeRowCell(s.rowIndex,t),b.removeRowCell(s.rowIndex,i),Te.play(),s.columnsCount-=2)}}),O.filter(s=>s.columnsCount===0).forEach(s=>{b.shiftEmptyRows(s.rowIndex),s.columnsCount=-1})):(N=!1,O=[],Fe(Z),Z=0),se=0):(I.isMoving&&I.rowIndex>=0&&(I.move(),V>0&&(V-=10)),++V>ye&&(I.rowIndex+I.height<G&&(I.moveDown(),b.isCollision(I)&&(I.moveUp(),U.play(),B())),I.rowIndex+I.height>=G&&(U.play(),B()),V=0)),A.drawFieldMatrix(b),A.drawGameFigure(I),b.isOver()&&!N){Me();return}requestAnimationFrame(()=>{de()})}function B(){b.merge(I),I=D,D=new q(b,B),A.cleartNextFigure(),A.drawNextFigure(D),Z=b.getFullRowsCount(),Z>0&&(N=!0,O=b.getFullRowIndexes().map(s=>({rowIndex:s,columnsCount:k})))}function Fe(s){W+=$*s*10,Q+=s,A.clearScoreInfo(),A.drawScoreInfo($,Q,W)}function Me(){z=!1,ue.stop(),A.drawInfo("GAME OVER",Ae),A.drawSecondaryInfo("press space to start",X)}document.addEventListener("keypress",function(s){if(s.keyCode===32){if(z)return;z=!0,ke()}});function ke(){D=new q(b,B),I=new q(b,B),V=0,$=1,W=0,Q=0,N=!1,Z=0,O=[],A.clear(),A.drawGameField(),A.drawNextFigureField(),A.drawNextFigure(D),A.drawScoreInfo($,Q,W),A.drawSoundControl(),b.reset(),ue.play(),de()}A.drawGameField();A.drawNextFigureField();A.drawNextFigure(D);A.drawScoreInfo($,Q,W);A.drawInfo("GET READY!",X);A.drawSecondaryInfo("press space to start",X);
