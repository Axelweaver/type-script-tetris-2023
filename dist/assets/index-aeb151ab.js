var B=Object.defineProperty;var b=(o,t,e)=>t in o?B(o,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):o[t]=e;var r=(o,t,e)=>(b(o,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const i of document.querySelectorAll('link[rel="modulepreload"]'))s(i);new MutationObserver(i=>{for(const n of i)if(n.type==="childList")for(const l of n.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&s(l)}).observe(document,{childList:!0,subtree:!0});function e(i){const n={};return i.integrity&&(n.integrity=i.integrity),i.referrerPolicy&&(n.referrerPolicy=i.referrerPolicy),i.crossOrigin==="use-credentials"?n.credentials="include":i.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function s(i){if(i.ep)return;i.ep=!0;const n=e(i);fetch(i.href,n)}})();function p(o,t){o!=null&&o.clearRect(t.positionX,t.positionY,t.width,t.height)}function q(o,t,e,s,i,n,l){if(o==null)return;const a=Math.round(n*.1);o.strokeStyle=t,o.beginPath(),o.lineWidth=1,o.moveTo(s+a,i+l-a),o.lineTo(s+a,i+a),o.lineTo(s+n-a,i+a),o.stroke(),o.beginPath(),o.strokeStyle=e,o.moveTo(s+a,i+l-a),o.lineTo(s-a+n,i+l-a),o.lineTo(s-a+n,i+a),o.stroke()}function R(o,t,e,s,i,n){o!=null&&(o.strokeStyle=t,o.strokeRect(e,s,i,n))}function S(o,t,e,s,i,n){o!=null&&(o.fillStyle=t,o.fillRect(e,s,i,n))}function f(o,t,e,s){o!=null&&(o.fillStyle=e,o.font=t.font,o.textAlign=t.align,o.textBaseline="middle",o.fillText(s,t.positionX,t.positionY))}function k(o,t){return Math.floor(Math.random()*(t-o+1))+o}function z(o){const t=o.length-1;return o.map((s,i)=>s.map((n,l)=>o[t-l][i]))}const P="#gameCanvas",u=10,g=20,_=2,A=-2,D=3,U=94,m="#F0FFF0",K="#800000",L=[[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]],[[1,1,1],[0,0,1],[0,0,0]],[[1,1,1],[1,0,0],[0,0,0]],[[1,1],[1,1]],[[0,1,1],[1,1,0],[0,0,0]],[[1,1,1],[0,1,0],[0,0,0]],[[1,1,0],[0,1,1],[0,0,0]]],G=[["#87CEFA","#48D1CC","#AFEEEE"],["#B22222","#8B0000","#CD5C5C"],["#228B22","#006400","#98FB98"],["#0000CD","#00008B","#4169E1"],["#98FB98","#66CDAA","#7FFF00"],["#FFD700","#DAA520","#FFFACD"],["#FF69B4","#CD5C5C","#FFB6C1"]];class E{constructor(t,e){r(this,"_matrix");r(this,"_color");r(this,"_darkColor");r(this,"_lightColor");r(this,"_rowIndex");r(this,"_columnIndex");r(this,"_width");r(this,"_height");r(this,"_moveLeft");r(this,"_moveRight");r(this,"_moveDown");r(this,"_rotate");r(this,"_gameField");r(this,"_mergeFunc");r(this,"_eventHandlerKeydown",t=>{(t.keyCode===37||t.keyCode===65)&&(this._moveLeft=!0),(t.keyCode===39||t.keyCode===68)&&(this._moveRight=!0),(t.keyCode===40||t.keyCode===83)&&(this._moveDown=!0),(t.keyCode===38||t.keyCode===119)&&(this._rotate=!0)});r(this,"_eventHandlerKeyup",t=>{(t.keyCode===37||t.keyCode===65)&&(this._moveLeft=!1),(t.keyCode===39||t.keyCode===68)&&(this._moveRight=!1),(t.keyCode===40||t.keyCode===83)&&(this._moveDown=!1),(t.keyCode===38||t.keyCode===87)&&(this._rotate=!1)});this._gameField=t,this._mergeFunc=e,this._matrix=L[k(0,L.length-1)];const s=G[k(0,G.length-1)];this._color=s[0],this._darkColor=s[1],this._lightColor=s[2],this._height=0,this._width=0,this._rowIndex=A,this._columnIndex=D,this._moveLeft=!1,this._moveRight=!1,this._moveDown=!1,this._rotate=!1,this._calcSize(),document.addEventListener("keydown",this._eventHandlerKeydown),document.addEventListener("keyup",this._eventHandlerKeyup)}_calcSize(){const t=this._matrix.map(e=>e.map((s,i)=>s===1?i+1:0)).filter(e=>e.length!==0).flatMap(e=>e);this._width=Math.max(...t),this._height=this._matrix.filter(e=>e.some(s=>s===1)).length}_checkAndNormalize(){for(;this._matrix[0].every(t=>t===0);)this._matrix=this._matrix.slice(1).concat([new Array(this._matrix.length).fill(0)]);for(;this._matrix.every(t=>t[0]===0);)this._matrix=this._matrix.map(t=>t.slice(1).concat([0]))}move(){if(this._moveLeft&&this._columnIndex>0&&(--this._columnIndex,this._gameField.isCollision(this)&&++this._columnIndex),this._moveRight&&this._columnIndex+this._width<u&&(++this._columnIndex,this._gameField.isCollision(this)&&--this._columnIndex),this._moveDown&&this._rowIndex+this._height<g&&(++this._rowIndex,this._gameField.isCollision(this)&&(--this._rowIndex,this._mergeFunc(),this._rowIndex=A,this._columnIndex=D)),this._rotate&&this._rowIndex>=0){const t=this._matrix;for(this.rotate();this._columnIndex+this._width>=u;)--this._columnIndex;(this._rowIndex+this._height>=g||this._gameField.isCollision(this))&&(this._matrix=t)}}get matrix(){return this._matrix}get color(){return this._color}get darkColor(){return this._darkColor}get lightColor(){return this._lightColor}get rowIndex(){return this._rowIndex}get columnIndex(){return this._columnIndex}get width(){return this._width}get height(){return this._height}get isMovingDown(){return this._moveDown}moveUp(){--this._rowIndex}moveDown(){++this._rowIndex}rotate(){this._matrix=z(this._matrix),this._checkAndNormalize(),this._calcSize()}}class V{constructor(){r(this,"_coloredMatrix");this._coloredMatrix=[];for(let t=0;t<g;++t)this._coloredMatrix.push(new Array(u).fill({color:"",darkColor:"",lightColor:"",value:0}))}merge(t){t.matrix.forEach((e,s)=>{e.forEach((i,n)=>{const l=t.rowIndex+s;if(i===1&&l>=0){const a=n+t.columnIndex;this._coloredMatrix[l][a]={color:t.color,darkColor:t.darkColor,lightColor:t.lightColor,value:1}}})})}isCollision(t){for(let e=0;e<t.matrix.length;++e)for(let s=0;s<t.matrix[e].length;++s){if(t.rowIndex<0)continue;const i=e+t.rowIndex,n=s+t.columnIndex;if(t.matrix[e][s]===1&&this._coloredMatrix[i][n].value===1)return!0}return!1}hasFullRows(){return!!this._coloredMatrix.some(t=>t.every(e=>e.value===1))}getFullRowIndexes(){return this._coloredMatrix.map((e,s)=>e.every(i=>(i==null?void 0:i.value)===1)?s:0).filter(e=>e>0)}getFullRowsCount(){return this.getFullRowIndexes().length}removeRowCell(t,e){this._coloredMatrix[t][e]={color:"",darkColor:"",lightColor:"",value:0}}shiftEmptyRows(t){this._coloredMatrix.splice(t,1),this._coloredMatrix.unshift(new Array(u).fill({color:"",darkColor:"",lightColor:"",value:0}))}isOver(){return this._coloredMatrix[0].some(t=>t.value===1)}get coloredMatrix(){return this._coloredMatrix}}class ${constructor(t){r(this,"canvas");r(this,"_context");r(this,"_gameField");r(this,"_nextFigureField");r(this,"_scoreField");r(this,"_textInfo");r(this,"_secondaryTextInfo");r(this,"_gameSquare");this.canvas=document.querySelector(t),this._context=this.canvas.getContext("2d");const e=Math.round(this.canvas.width/2);this._gameField={positionX:Math.round(this.canvas.width/2)-Math.round(e/2),positionY:Math.round(this.canvas.height/2)-Math.round(e/2)*2,width:e,height:e*2},this._nextFigureField={positionX:this._gameField.positionX+this._gameField.width+Math.round(e/8),positionY:this._gameField.positionY+Math.round(e/8),width:Math.round(e/4),height:Math.round(e/4)*2},this._scoreField={positionX:12,positionY:this._nextFigureField.positionY-28,width:Math.round(this.canvas.width/4)-18,height:this._gameField.height},this._textInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2),fontSize:Math.round(this.canvas.width/18),font:"",align:"center"},this._textInfo.font=`bold ${this._textInfo.fontSize}px Cascadia Mono SemiBold`,this._secondaryTextInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2)+Math.round(this.canvas.height/5),fontSize:Math.round(this.canvas.width/22),font:"",align:"center"},this._secondaryTextInfo.font=`bold ${this._secondaryTextInfo.fontSize}px Cascadia Mono SemiBold`,this._gameSquare={width:Math.round(e/u)-_,height:Math.round(this._gameField.height/g)-_}}clearGameField(){p(this._context,this._gameField)}cleartNextFigure(){p(this._context,this._nextFigureField)}clearScoreInfo(){p(this._context,this._scoreField)}drawScoreInfo(t,e,s){const i=this._secondaryTextInfo;i.positionX=12,i.positionY=this._nextFigureField.positionY-20,i.font="bold 16px Cascadia Mono SemiBold",i.align="left",f(this._context,i,m,"SCORE:"),i.font="bold 20px Cascadia Mono SemiBold",i.positionY+=40,f(this._context,i,m,`${s}`.padStart(9,"0")),i.positionY+=80,i.font="bold 16px Cascadia Mono SemiBold",f(this._context,i,m,`LEVEL: ${t}`),i.positionY+=80,f(this._context,i,m,`LINES: ${e}`)}drawNextFigureField(){const t=this._secondaryTextInfo;t.positionX=this._nextFigureField.positionX,t.positionY=this._nextFigureField.positionY-20,t.font="bold 16px Cascadia Mono SemiBold",t.align="left",f(this._context,t,m,"N E X T:");for(let e=1;e<3;++e)R(this._context,m,this._nextFigureField.positionX-e,this._nextFigureField.positionY-e,this._nextFigureField.width+e*2,this._nextFigureField.height+e*2)}drawGameField(){for(let t=1;t<4;++t)R(this._context,m,this._gameField.positionX-_-t,this._gameField.positionY-_-t,this._gameField.width+_+t*2,this._gameField.height+_+t*2)}drawNextFigure(t){const e=Math.round(this._nextFigureField.width/5)-1;t.matrix.forEach((s,i)=>{s.forEach((n,l)=>{if(n===1){const a=this._nextFigureField.positionX+(l+1)*(e+1),X=this._nextFigureField.positionY+(i+3)*(e+1);S(this._context,t.color,a,X,e,e)}})})}drawGameFigure(t){t.matrix.forEach((e,s)=>{e.forEach((i,n)=>{i===1&&this.drawGameSquare(t.columnIndex+n,t.rowIndex+s,t.color,t.darkColor,t.lightColor)})})}drawGameSquare(t,e,s,i,n){if(e<0)return;const l=this._gameField.positionX+(this._gameSquare.width+_)*t,a=this._gameField.positionY+(this._gameSquare.height+_)*e;S(this._context,s,l,a,this._gameSquare.width,this._gameSquare.height),q(this._context,i,n,l,a,this._gameSquare.width,this._gameSquare.height)}drawFieldMatrix(t){t.coloredMatrix.forEach((e,s)=>{e.forEach((i,n)=>{(i==null?void 0:i.value)===1&&this.drawGameSquare(n,s,i==null?void 0:i.color,i==null?void 0:i.darkColor,i==null?void 0:i.lightColor)})})}drawInfo(t,e){f(this._context,this._textInfo,e,t)}drawSecondaryInfo(t,e){f(this._context,this._secondaryTextInfo,e,t)}}const d=new $(P),h=new V;let w=new E(h,F),c=new E(h,F),O=0,N=0;const v=1;let M=0,y=0,I=!1,C=0,x=[],T=0;function Y(){if(d.clearGameField(),I&&++T>6?(x.some(o=>o.columnsCount>0)?(x.forEach((o,t)=>{if(t===0||x[t-1].columnsCount<u-2){const e=u-Math.floor(o.columnsCount/2),s=Math.floor(o.columnsCount/2)-1;o.columnsCount>0&&(h.removeRowCell(o.rowIndex,e),h.removeRowCell(o.rowIndex,s),o.columnsCount-=2)}}),x.filter(o=>o.columnsCount===0).forEach(o=>{h.shiftEmptyRows(o.rowIndex)})):(I=!1,x=[],H(C),C=0),T=0):(++N>12&&(c.move(),N=0),++O>U&&(c.rowIndex+c.height<g&&(c.moveDown(),h.isCollision(c)&&(c.moveUp(),F())),c.rowIndex+c.height>=g&&F(),O=0)),d.drawFieldMatrix(h),d.drawGameFigure(c),h.isOver()&&!I){W();return}requestAnimationFrame(()=>{Y()})}function F(){h.merge(c),c=w,w=new E(h,F),d.cleartNextFigure(),d.drawNextFigure(w),C=h.getFullRowsCount(),C>0&&(I=!0,x=h.getFullRowIndexes().map(o=>({rowIndex:o,columnsCount:u})))}function H(o){M+=v*o*10,y+=o,d.clearScoreInfo(),d.drawScoreInfo(v,y,M)}function W(){d.drawInfo("GAME OVER",K)}d.drawGameField();d.drawNextFigureField();d.drawNextFigure(w);d.drawScoreInfo(v,y,M);Y();
