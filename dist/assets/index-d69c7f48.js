var O=Object.defineProperty;var N=(i,t,e)=>t in i?O(i,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[t]=e;var l=(i,t,e)=>(N(i,typeof t!="symbol"?t+"":t,e),e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))r(o);new MutationObserver(o=>{for(const n of o)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&r(h)}).observe(document,{childList:!0,subtree:!0});function e(o){const n={};return o.integrity&&(n.integrity=o.integrity),o.referrerPolicy&&(n.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?n.credentials="include":o.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function r(o){if(o.ep)return;o.ep=!0;const n=e(o);fetch(o.href,n)}})();function F(i,t){i!=null&&i.clearRect(t.positionX,t.positionY,t.width,t.height)}function T(i,t,e,r,o,n,h){if(i==null)return;const a=Math.round(n*.1);i.strokeStyle=t,i.beginPath(),i.lineWidth=1,i.moveTo(r+a,o+h-a),i.lineTo(r+a,o+a),i.lineTo(r+n-a,o+a),i.stroke(),i.beginPath(),i.strokeStyle=e,i.moveTo(r+a,o+h-a),i.lineTo(r-a+n,o+h-a),i.lineTo(r-a+n,o+a),i.stroke()}function y(i,t,e,r,o,n){i!=null&&(i.strokeStyle=t,i.strokeRect(e,r,o,n))}function S(i,t,e,r,o,n){i!=null&&(i.fillStyle=t,i.fillRect(e,r,o,n))}function _(i,t,e,r){i!=null&&(i.fillStyle=e,i.font=t.font,i.textAlign=t.align,i.textBaseline="middle",i.fillText(r,t.positionX,t.positionY))}function A(i,t){return Math.floor(Math.random()*(t-i+1))+i}function U(i){const t=i.length-1;return i.map((r,o)=>r.map((n,h)=>i[t-h][o]))}const Y="#gameCanvas",w=10,g=20,u=2,X=-2,B=3,b=94,f="#F0FFF0",q="#800000",R=[[[1,0,0,0],[1,0,0,0],[1,0,0,0],[1,0,0,0]],[[1,1,1],[0,0,1],[0,0,0]],[[1,1,1],[1,0,0],[0,0,0]],[[1,1],[1,1]],[[0,1,1],[1,1,0],[0,0,0]],[[1,1,1],[0,1,0],[0,0,0]],[[1,1,0],[0,1,1],[0,0,0]]],E=[["#87CEFA","#48D1CC","#AFEEEE"],["#B22222","#8B0000","#CD5C5C"],["#228B22","#006400","#98FB98"],["#0000CD","#00008B","#4169E1"],["#98FB98","#66CDAA","#7FFF00"],["#FFD700","#DAA520","#FFFACD"],["#FF69B4","#CD5C5C","#FFB6C1"]];class v{constructor(){l(this,"_matrix");l(this,"_color");l(this,"_darkColor");l(this,"_lightColor");l(this,"_rowIndex");l(this,"_columnIndex");l(this,"_width");l(this,"_height");this._matrix=R[A(0,R.length-1)];const t=E[A(0,E.length-1)];this._color=t[0],this._darkColor=t[1],this._lightColor=t[2],this._height=0,this._width=0,this._rowIndex=X,this._columnIndex=B,this._calcSize()}_calcSize(){const t=this._matrix.map(e=>e.map((r,o)=>r===1?o+1:0)).filter(e=>e.length!==0).flatMap(e=>e);this._width=Math.max(...t),this._height=this._matrix.filter(e=>e.some(r=>r===1)).length}_checkAndNormalize(){for(;this._matrix[0].every(t=>t===0);)this._matrix=this._matrix.slice(1).concat([new Array(this._matrix.length).fill(0)]);for(;this._matrix.every(t=>t[0]===0);)this._matrix=this._matrix.map(t=>t.slice(1).concat([0]))}get matrix(){return this._matrix}get color(){return this._color}get darkColor(){return this._darkColor}get lightColor(){return this._lightColor}get rowIndex(){return this._rowIndex}get columnIndex(){return this._columnIndex}get width(){return this._width}get height(){return this._height}setMatrix(t){this._matrix=t,this._checkAndNormalize(),this._calcSize()}moveUp(){--this._rowIndex}moveDown(){++this._rowIndex}moveLeft(){--this._columnIndex}moveRight(){++this._columnIndex}rotate(){this._matrix=U(this._matrix),this._checkAndNormalize(),this._calcSize()}}class z{constructor(){l(this,"_coloredMatrix");this._coloredMatrix=[];for(let t=0;t<g;++t)this._coloredMatrix.push(new Array(w).fill({color:"",darkColor:"",lightColor:"",value:0}))}merge(t){t.matrix.forEach((e,r)=>{e.forEach((o,n)=>{const h=t.rowIndex+r;if(o===1&&h>=0){const a=n+t.columnIndex;this._coloredMatrix[h][a]={color:t.color,darkColor:t.darkColor,lightColor:t.lightColor,value:1}}})})}isCollision(t){for(let e=0;e<t.matrix.length;++e)for(let r=0;r<t.matrix[e].length;++r){if(t.rowIndex<0)continue;const o=e+t.rowIndex,n=r+t.columnIndex;if(console.log(t,this._coloredMatrix,o,n),t.matrix[e][r]===1&&this._coloredMatrix[o][n].value===1)return!0}return!1}hasFullRows(){return!!this._coloredMatrix.some(t=>t.every(e=>e.value===1))}_getFullRowIndexes(){return this._coloredMatrix.map((e,r)=>e.every(o=>(o==null?void 0:o.value)===1)?r:0).filter(e=>e>0)}getFullRowsCount(){return this._getFullRowIndexes().length}removeFullRows(){const t=this._getFullRowIndexes(),e=t.length,r=Math.min(...t);this._coloredMatrix.splice(r,e);for(let o=0;o<e;++o)this._coloredMatrix.unshift(new Array(w).fill({color:"",darkColor:"",lightColor:"",value:0}))}isOver(){return this._coloredMatrix[0].some(t=>t.value===1)}get coloredMatrix(){return this._coloredMatrix}}function K(i){return t=>{(t.code==="ArrowLeft"||t.key==="ArrowLeft"||t.code==="KeyA"||t.key.toUpperCase()==="A")&&(i.moveLeft=!0),(t.code==="ArrowRight"||t.key==="ArrowRight"||t.code==="KeyD"||t.key.toUpperCase()==="D")&&(i.moveRight=!0),(t.code==="ArrowDown"||t.key==="ArrowDown"||t.code==="KeyS"||t.key.toUpperCase()==="S")&&(i.moveDown=!0),(t.code==="ArrowUp"||t.key==="ArrowUp"||t.code==="KeyW"||t.key.toUpperCase()==="W")&&(i.rotateFigure=!0)}}function P(i){return t=>{(t.code==="ArrowLeft"||t.key==="ArrowLeft"||t.code==="KeyA"||t.key.toUpperCase()==="A")&&(i.moveLeft=!1),(t.code==="ArrowRight"||t.key==="ArrowRight"||t.code==="KeyD"||t.key.toUpperCase()==="D")&&(i.moveRight=!1),(t.code==="ArrowDown"||t.key==="ArrowDown"||t.code==="KeyS"||t.key.toUpperCase()==="S")&&(i.moveDown=!1),(t.code==="ArrowUp"||t.key==="ArrowUp"||t.code==="KeyW"||t.key.toUpperCase()==="W")&&(i.rotateFigure=!1)}}class W{constructor(t){l(this,"canvas");l(this,"_context");l(this,"_gameField");l(this,"_nextFigureField");l(this,"_scoreField");l(this,"_textInfo");l(this,"_secondaryTextInfo");l(this,"_gameSquare");this.canvas=document.querySelector(t),this._context=this.canvas.getContext("2d");const e=Math.round(this.canvas.width/2);this._gameField={positionX:Math.round(this.canvas.width/2)-Math.round(e/2),positionY:Math.round(this.canvas.height/2)-Math.round(e/2)*2,width:e,height:e*2},this._nextFigureField={positionX:this._gameField.positionX+this._gameField.width+Math.round(e/8),positionY:this._gameField.positionY+Math.round(e/8),width:Math.round(e/4),height:Math.round(e/4)*2},this._scoreField={positionX:12,positionY:this._nextFigureField.positionY-20,width:Math.round(this.canvas.width/4)-18,height:this._gameField.height},this._textInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2),fontSize:Math.round(this.canvas.width/18),font:"",align:"center"},this._textInfo.font=`bold ${this._textInfo.fontSize}px Cascadia Mono SemiBold`,this._secondaryTextInfo={positionX:Math.round(this.canvas.width/2),positionY:Math.round(this.canvas.height/2)+Math.round(this.canvas.height/5),fontSize:Math.round(this.canvas.width/22),font:"",align:"center"},this._secondaryTextInfo.font=`bold ${this._secondaryTextInfo.fontSize}px Cascadia Mono SemiBold`,this._gameSquare={width:Math.round(e/w)-u,height:Math.round(this._gameField.height/g)-u}}clearGameField(){F(this._context,this._gameField)}cleartNextFigure(){F(this._context,this._nextFigureField)}clearScoreInfo(){F(this._context,this._scoreField)}drawScoreInfo(t,e,r){const o=this._secondaryTextInfo;o.positionX=12,o.positionY=this._nextFigureField.positionY-20,o.font="bold 16px Cascadia Mono SemiBold",o.align="left",_(this._context,o,f,"SCORE:"),o.font="bold 20px Cascadia Mono SemiBold",o.positionY+=40,_(this._context,o,f,`${r}`.padStart(9,"0")),o.positionY+=80,o.font="bold 16px Cascadia Mono SemiBold",_(this._context,o,f,`LEVEL: ${t}`),o.positionY+=80,_(this._context,o,f,`LINES: ${e}`)}drawNextFigureField(){const t=this._secondaryTextInfo;t.positionX=this._nextFigureField.positionX,t.positionY=this._nextFigureField.positionY-20,t.font="bold 16px Cascadia Mono SemiBold",t.align="left",_(this._context,t,f,"N E X T:");for(let e=1;e<3;++e)y(this._context,f,this._nextFigureField.positionX-e,this._nextFigureField.positionY-e,this._nextFigureField.width+e*2,this._nextFigureField.height+e*2)}drawGameField(){for(let t=1;t<4;++t)y(this._context,f,this._gameField.positionX-u-t,this._gameField.positionY-u-t,this._gameField.width+u+t*2,this._gameField.height+u+t*2)}drawNextFigure(t){const e=Math.round(this._nextFigureField.width/5)-1;t.matrix.forEach((r,o)=>{r.forEach((n,h)=>{if(n===1){const a=this._nextFigureField.positionX+(h+1)*(e+1),G=this._nextFigureField.positionY+(o+3)*(e+1);S(this._context,t.color,a,G,e,e)}})})}drawGameFigure(t){t.matrix.forEach((e,r)=>{e.forEach((o,n)=>{o===1&&this.drawGameSquare(t.columnIndex+n,t.rowIndex+r,t.color,t.darkColor,t.lightColor)})})}drawGameSquare(t,e,r,o,n){if(e<0)return;const h=this._gameField.positionX+(this._gameSquare.width+u)*t,a=this._gameField.positionY+(this._gameSquare.height+u)*e;S(this._context,r,h,a,this._gameSquare.width,this._gameSquare.height),T(this._context,o,n,h,a,this._gameSquare.width,this._gameSquare.height)}drawFieldMatrix(t){t.coloredMatrix.forEach((e,r)=>{e.forEach((o,n)=>{(o==null?void 0:o.value)===1&&this.drawGameSquare(n,r,o==null?void 0:o.color,o==null?void 0:o.darkColor,o==null?void 0:o.lightColor)})})}drawInfo(t,e){_(this._context,this._textInfo,e,t)}drawSecondaryInfo(t,e){_(this._context,this._secondaryTextInfo,e,t)}}const m={moveLeft:!1,moveRight:!1,moveDown:!1,rotateFigure:!1};document.addEventListener("keydown",K(m));document.addEventListener("keyup",P(m));const d=new W(Y);let x=new v,s=new v,D=0,L=0;const c=new z,I=1;let C=0,M=0;function k(){if(d.clearGameField(),++L>10){if(m.moveLeft&&s.columnIndex>0&&(s.moveLeft(),c.isCollision(s)&&s.moveRight()),m.moveRight&&s.columnIndex+s.width<w&&(s.moveRight(),c.isCollision(s)&&s.moveLeft()),m.moveDown&&s.rowIndex+s.height<g&&(s.moveDown(),c.isCollision(s)&&(s.moveUp(),p())),m.rotateFigure&&s.rowIndex>=0){const i=s.matrix;for(s.rotate();s.columnIndex+s.width>=w;)s.moveLeft();(s.rowIndex+s.height>=g||c.isCollision(s))&&s.setMatrix(i)}L=0}if(++D>b&&(s.rowIndex+s.height<g&&(s.moveDown(),c.isCollision(s)&&(s.moveUp(),p())),s.rowIndex+s.height>=g&&p(),D=0),d.drawFieldMatrix(c),d.drawGameFigure(s),c.isOver()){V();return}requestAnimationFrame(()=>{k()})}function p(){c.merge(s),s=x,x=new v,d.cleartNextFigure(),d.drawNextFigure(x);const i=c.getFullRowsCount();i>0&&(C+=I*i*10,M+=i,c.removeFullRows(),d.clearScoreInfo(),d.drawScoreInfo(I,M,C))}function V(){d.drawInfo("GAME OVER",q)}d.drawGameField();d.drawNextFigureField();d.drawNextFigure(x);d.drawScoreInfo(I,M,C);k();
